!function(){function g(){}function i(a){var b=a.length-1;return function(){var c=h.call(arguments,0,b),d=h.call(arguments,b);return a.apply(this,c.concat([d]))}}function k(a){return i(function(b,c){"function"!=typeof b&&(b=j(b));var d=function(a){return b.apply(a,[a].concat(c))};return a.call(this,d)})}function l(a){var b=h.call(arguments,1);return function(){return a.apply(this,b)}}function m(a,b){if(!b)throw new Error("prayer failed: "+a)}function q(a){m("a direction was passed",a===o||a===p)}function u(a,b,c){m("a parent is always present",a),m("leftward is properly set up",function(){return b?b[p]===c&&b.parent===a:a.ends[o]===c}()),m("rightward is properly set up",function(){return c?c[o]===b&&c.parent===a:a.ends[p]===b}())}function G(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function H(a){return G(),Ua(a)}function K(b){function c(a){if(!a||!a.nodeType)return null;var b=r(a).children(".mq-root-block").attr(d),c=b&&t.byId[b].controller;return c?e[c.KIND_OF_MQ](c):null}function f(a,b){b&&b.handlers&&(b.handlers={fns:b.handlers,APIClasses:e});for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],f=D[c];a[c]=f?f(d):d}}if(!(I<=b&&b<=J))throw"Only interface versions between "+I+" and "+J+" supported. You specified: "+b;var e={};c.L=o,c.R=p,c.saneKeyboardEvents=N,c.config=function(a){return f(C.p,a),this},c.registerEmbed=function(a,b){if(!/^[a-z][a-z0-9]*$/i.test(a))throw"Embed name must start with letter and be only letters and digits";F[a]=b};var h=e.AbstractMathQuill=n(E,function(a){a.init=function(a){this.__controller=a,this.__options=a.options,this.id=a.id,this.data=a.data},a.__mathquillify=function(a){var b=this.__controller,c=b.root,e=b.container;b.createTextarea();var f=e.addClass(a).contents().detach();c.jQ=r('<span class="mq-root-block"/>').attr(d,c.id).appendTo(e),this.latex(f.text()),this.revert=function(){return e.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(f)}},a.config=function(a){return f(this.__options,a),this},a.el=function(){return this.__controller.container[0]},a.text=function(){return this.__controller.exportText()},a.latex=function(a){return arguments.length>0?(this.__controller.renderLatexMath(a),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},a.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},a.reflow=function(){return this.__controller.root.postOrder("reflow"),this}});c.prototype=h.prototype,e.EditableField=n(h,function(b,c){b.__mathquillify=function(){return c.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},b.focus=function(){return this.__controller.textarea.focus(),this},b.blur=function(){return this.__controller.textarea.blur(),this},b.write=function(a){return this.__controller.writeLatex(a),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},b.cmd=function(a){var b=this.__controller.notify(),c=b.cursor;if(/^\\[a-z]+$/i.test(a)){a=a.slice(1);var d=w[a]||Ba[a];d&&(a=d(a),c.selection&&a.replaces(c.replaceSelection()),a.createLeftOf(c.show()),this.__controller.scrollHoriz())}else c.parent.write(c,a);return b.blurred&&c.hide().parent.blur(),this},b.select=function(){var a=this.__controller;for(a.notify("move").cursor.insAtRightEnd(a.root);a.cursor[o];)a.selectLeft();return this},b.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},b.moveToDirEnd=function(a){return this.__controller.notify("move").cursor.insAtDirEnd(a,this.__controller.root),this},b.moveToLeftEnd=function(){return this.moveToDirEnd(o)},b.moveToRightEnd=function(){return this.moveToDirEnd(p)},b.keystroke=function(a){for(var a=a.replace(/^\s+|\s+$/g,"").split(/\s+/),b=0;b<a.length;b+=1)this.__controller.keystroke(a[b],{preventDefault:g});return this},b.typedText=function(a){for(var b=0;b<a.length;b+=1)this.__controller.typedText(a.charAt(b));return this},b.dropEmbedded=function(a,b,c){var d=a-r(window).scrollLeft(),e=b-r(window).scrollTop(),f=document.elementFromPoint(d,e);this.__controller.seek(r(f),a,b);var g=Aa().setOptions(c);g.createLeftOf(this.__controller.cursor)},b.clickAt=function(b,c,d){d=d||document.elementFromPoint(b,c);var e=this.__controller,f=e.root;return a.contains(f.jQ[0],d)||(d=f.jQ[0]),e.seek(r(d),b+pageXOffset,c+pageYOffset),e.blurred&&this.focus(),this},b.ignoreNextMousedown=function(a){return this.__controller.cursor.options.ignoreNextMousedown=a,this}}),c.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},c.EditableField.prototype=e.EditableField.prototype;for(var i in B)(function(a,d){var f=e[a]=d(e);c[a]=function(d,e){var g=c(d);if(g instanceof f||!d||!d.nodeType)return g;var h=A(f.RootBlock(),r(d),C());return h.KIND_OF_MQ=a,f(h).__mathquillify(e,b)},c[a].prototype=f.prototype})(i,B[i]);return c}function M(a){for(var b="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" "),c=0;c<b.length;c+=1)(function(b){a[b]=function(a){this.controller.handle(b,a)}})(b[c]);a.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function Z(a,b,c){return n(X,{ctrlSeq:a,htmlTemplate:"<"+b+" "+c+">&0</"+b+">"})}function ma(a){var b=this.parent,c=a;do{if(c[p])return a.insLeftOf(b);c=c.parent.parent}while(c!==b);a.insRightOf(b)}function ua(a,b){a.jQadd=function(){b.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},a.reflow=function(){var a=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));ba(this.delimjQs,e(1+.2*(a-1),1.2),1.2*a)}}function xa(a,b){var b=b||a,c=wa[a],d=wa[b];x[a]=l(va,o,a,c,b,d),x[c]=l(va,p,a,c,b,d)}var b,a=window.jQuery,c="mathquill-command-id",d="mathquill-block-id",e=Math.min,f=Math.max;if(!a)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";var h=[].slice,j=i(function(a,b){return i(function(c,d){if(a in c)return c[a].apply(c,b.concat(d))})}),n=function(a,b,c){function d(a){return"object"==typeof a}function e(a){return"function"==typeof a}function f(){}return function g(h,i){function j(){var a=new k;return e(a.init)&&a.init.apply(a,arguments),a}function k(){}i===c&&(i=h,h=Object),j.Bare=k;var n,l=f[a]=h[a],m=k[a]=j[a]=j.p=new f;return m.constructor=j,j.extend=function(a){return g(j,a)},(j.open=function(a){if(n={},e(a)?n=a.call(j,m,l,j,h):d(a)&&(n=a),d(n))for(var c in n)b.call(n,c)&&(m[c]=n[c]);return e(m.init)||(m.init=h),j})(i)}}("prototype",{}.hasOwnProperty),o=-1,p=1,r=n(a,function(a){a.insDirOf=function(a,b){return a===o?this.insertBefore(b.first()):this.insertAfter(b.last())},a.insAtDirEnd=function(a,b){return a===o?this.prependTo(b):this.appendTo(b)}}),s=n(function(a){a.parent=0,a[o]=0,a[p]=0,a.init=function(a,b,c){this.parent=a,this[o]=b,this[p]=c},this.copy=function(a){return s(a.parent,a[o],a[p])}}),t=n(function(a){function c(){return b+=1}a[o]=0,a[p]=0,a.parent=0;var b=0;this.byId={},a.init=function(){this.id=c(),t.byId[this.id]=this,this.ends={},this.ends[o]=0,this.ends[p]=0},a.dispose=function(){delete t.byId[this.id]},a.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},a.jQ=r(),a.jQadd=function(a){return this.jQ=this.jQ.add(a)},a.jQize=function(a){function b(a){if(a.getAttribute){var c=a.getAttribute("mathquill-command-id"),d=a.getAttribute("mathquill-block-id");c&&t.byId[c].jQadd(a),d&&t.byId[d].jQadd(a)}for(a=a.firstChild;a;a=a.nextSibling)b(a)}for(var a=r(a||this.html()),c=0;c<a.length;c+=1)b(a[c]);return a},a.createDir=function(a,b){q(a);var c=this;return c.jQize(),c.jQ.insDirOf(a,b.jQ),b[a]=c.adopt(b.parent,b[o],b[p]),c},a.createLeftOf=function(a){return this.createDir(o,a)},a.selectChildren=function(a,b){return z(a,b)},a.bubble=k(function(a){for(var b=this;b;b=b.parent){var c=a(b);if(c===!1)break}return this}),a.postOrder=k(function(a){return function b(c){c.eachChild(b),a(c)}(this),this}),a.isEmpty=function(){return 0===this.ends[o]&&0===this.ends[p]},a.isStyleBlock=function(){return!1},a.children=function(){return v(this.ends[o],this.ends[p])},a.eachChild=function(){var a=this.children();return a.each.apply(a,arguments),this},a.foldChildren=function(a,b){return this.children().fold(a,b)},a.withDirAdopt=function(a,b,c,d){return v(this,this).withDirAdopt(a,b,c,d),this},a.adopt=function(a,b,c){return v(this,this).adopt(a,b,c),this},a.disown=function(){return v(this,this).disown(),this},a.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),v=n(function(a){a.init=function(a,c,d){if(d===b&&(d=o),q(d),m("no half-empty fragments",!a==!c),this.ends={},a){m("withDir is passed to Fragment",a instanceof t),m("oppDir is passed to Fragment",c instanceof t),m("withDir and oppDir have the same parent",a.parent===c.parent),this.ends[d]=a,this.ends[-d]=c;var e=this.fold([],function(a,b){return a.push.apply(a,b.jQ.get()),a});this.jQ=this.jQ.add(e)}},a.jQ=r(),a.withDirAdopt=function(a,b,c,d){return a===o?this.adopt(b,c,d):this.adopt(b,d,c)},a.adopt=function(a,b,c){u(a,b,c);var d=this;d.disowned=!1;var e=d.ends[o];if(!e)return this;var f=d.ends[p];return b||(a.ends[o]=e),c?c[o]=f:a.ends[p]=f,d.ends[p][p]=c,d.each(function(c){c[o]=b,c.parent=a,b&&(b[p]=c),b=c}),d},a.disown=function(){var a=this,b=a.ends[o];if(!b||a.disowned)return a;a.disowned=!0;var c=a.ends[p],d=b.parent;return u(d,b[o],b),u(d,c,c[p]),b[o]?b[o][p]=c[p]:d.ends[o]=c[p],c[p]?c[p][o]=b[o]:d.ends[p]=b[o],a},a.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},a.each=k(function(a){var b=this,c=b.ends[o];if(!c)return b;for(;c!==b.ends[p][p];c=c[p]){var d=a(c);if(d===!1)break}return b}),a.fold=function(a,b){return this.each(function(c){a=b.call(this,a,c)}),a}}),w={},x={},y=n(s,function(a){a.init=function(a,b){this.parent=a,this.options=b;var c=this.jQ=this._jQ=r('<span class="mq-cursor">&#8203;</span>');this.blink=function(){c.toggleClass("mq-blink")},this.upDownCache={}},a.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[p]?this.selection&&this.selection.ends[o][o]===this[o]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[p].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},a.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=r(),this},a.withDirInsertAt=function(a,b,c,d){var e=this.parent;this.parent=b,this[a]=c,this[-a]=d,e!==b&&e.blur&&e.blur(this)},a.insDirOf=function(a,b){return q(a),this.jQ.insDirOf(a,b.jQ),this.withDirInsertAt(a,b.parent,b[a],b),this.parent.jQ.addClass("mq-hasCursor"),this},a.insLeftOf=function(a){return this.insDirOf(o,a)},a.insRightOf=function(a){return this.insDirOf(p,a)},a.insAtDirEnd=function(a,b){return q(a),this.jQ.insAtDirEnd(a,b.jQ),this.withDirInsertAt(a,b,0,b.ends[a]),b.focus(),this},a.insAtLeftEnd=function(a){return this.insAtDirEnd(o,a)},a.insAtRightEnd=function(a){return this.insAtDirEnd(p,a)},a.jumpUpDown=function(a,b){var c=this;c.upDownCache[a.id]=s.copy(c);var d=c.upDownCache[b.id];if(d)d[p]?c.insLeftOf(d[p]):c.insAtRightEnd(d.parent);else{var e=c.offset().left;b.seek(e,c)}},a.offset=function(){var a=this,b=a.jQ.removeClass("mq-cursor").offset();return a.jQ.addClass("mq-cursor"),b},a.unwrapGramp=function(){var a=this.parent.parent,b=a.parent,c=a[p],d=this,e=a[o];if(a.disown().eachChild(function(d){d.isEmpty()||(d.children().adopt(b,e,c).each(function(b){b.jQ.insertBefore(a.jQ.first())}),e=d.ends[p])}),!this[p])if(this[o])this[p]=this[o][p];else for(;!this[p];){if(this.parent=this.parent[p],!this.parent){this[p]=a[p],this.parent=b;break}this[p]=this.parent.ends[o]}this[p]?this.insLeftOf(this[p]):this.insAtRightEnd(b),a.jQ.remove(),a[o].siblingDeleted&&a[o].siblingDeleted(d.options,p),a[p].siblingDeleted&&a[p].siblingDeleted(d.options,o)},a.startSelection=function(){for(var a=this.anticursor=s.copy(this),b=a.ancestors={},c=a;c.parent;c=c.parent)b[c.parent.id]=c},a.endSelection=function(){delete this.anticursor},a.select=function(){var a=this.anticursor;if(this[o]===a[o]&&this.parent===a.parent)return!1;for(var b=this;b.parent;b=b.parent)if(b.parent.id in a.ancestors){var c=b.parent;break}m("cursor and anticursor in the same tree",c);var e,f,d=a.ancestors[c.id],g=p;if(b[o]!==d)for(var h=b;h;h=h[p])if(h[p]===d[p]){g=o,e=b,f=d;break}return g===p&&(e=d,f=b),e instanceof s&&(e=e[p]),f instanceof s&&(f=f[o]),this.hide().selection=c.selectChildren(e,f),this.insDirOf(g,this.selection.ends[g]),this.selectionChanged(),!0},a.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},a.deleteSelection=function(){this.selection&&(this[o]=this.selection.ends[o][o],this[p]=this.selection.ends[p][p],this.selection.remove(),this.selectionChanged(),delete this.selection)},a.replaceSelection=function(){var a=this.selection;return a&&(this[o]=a.ends[o][o],this[p]=a.ends[p][p],delete this.selection),a}}),z=n(v,function(a,b){a.init=function(){b.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},a.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),b.adopt.apply(this,arguments)},a.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},a.join=function(a){return this.fold("",function(b,c){return b+c[a]()})}}),A=n(function(a){a.init=function(a,b,c){this.id=a.id,this.data={},this.root=a,this.container=b,this.options=c,a.controller=this,this.cursor=a.cursor=y(a,c)},a.handle=function(a,b){var c=this.options.handlers;if(c&&c.fns[a]){var d=c.APIClasses[this.KIND_OF_MQ](this);b===o||b===p?c.fns[a](b,d):c.fns[a](d)}};var b=[];this.onNotify=function(a){b.push(a)},a.notify=function(){for(var a=0;a<b.length;a+=1)b[a].apply(this.cursor,arguments);return this}}),B={},C=n(),D={},E=n(),F={};H.prototype=E.p,H.VERSION="v0.10.1",H.interfaceVersion=function(a){if(1!==a)throw"Only interface version 1 supported. You specified: "+a;return G=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')},G(),H},H.getInterface=K;var I=K.MIN=1,J=K.MAX=2;H.noConflict=function(){return window.MathQuill=L,H};var L=window.MathQuill;window.MathQuill=H;var N=function(){function c(a){var e,c=a.which||a.keyCode,d=b[c],f=[];return a.ctrlKey&&f.push("Ctrl"),a.originalEvent&&a.originalEvent.metaKey&&f.push("Meta"),a.altKey&&f.push("Alt"),a.shiftKey&&f.push("Shift"),e=d||String.fromCharCode(c),f.length||d?(f.push(e),f.join("-")):e}var b={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(d,e){function m(a){k=a,clearTimeout(l),l=setTimeout(a)}function n(a){m(function(b){k=g,clearTimeout(l),a(b)})}function o(a){k(),k=g,clearTimeout(l),i.val(a),a&&i[0].select&&i[0].select(),p=!!a}function q(){var a=i[0];return"selectionStart"in a&&a.selectionStart!==a.selectionEnd}function r(){e.keystroke(c(f),f)}function s(a){f=a,h=null,p&&n(function(a){a&&"focusout"===a.type||!i[0].select||i[0].select()}),r()}function t(a){f&&h&&r(),h=a,m(v)}function u(a){f&&!h&&m(v)}function v(){if(!q()){var a=i.val();1===a.length?(i.val(""),e.typedText(a)):a&&i[0].select&&i[0].select()}}function w(){f=h=null}function x(a){i.focus(),m(y)}function y(){var a=i.val();i.val(""),a&&e.paste(a)}var l,f=null,h=null,i=a(d),j=a(e.container||i),k=g;j.bind("keydown keypress input keyup focusout paste",function(a){k(a)});var p=!1;return j.bind({keydown:s,keypress:t,keyup:u,focusout:w,cut:function(){n(function(){e.cut()})},copy:function(){n(function(){e.copy()})},paste:x}),{select:o}}}(),O=n(function(a,b,c){function d(a,b){throw a=a?"'"+a+"'":"EOF","Parse Error: "+b+" at "+a}a.init=function(a){this._=a},a.parse=function(a){function b(a,b){return b}return this.skip(r)._(""+a,b,d)},a.or=function(a){m("or is passed a parser",a instanceof c);var b=this;return c(function(c,d,e){function f(b){return a._(c,d,e)}return b._(c,d,f)})},a.then=function(a){var b=this;return c(function(d,e,f){function g(b,d){var g=a instanceof c?a:a(d);return m("a parser is returned",g instanceof c),g._(b,e,f)}return b._(d,g,f)})},a.many=function(){var a=this;return c(function(b,c,d){function f(a,c){return b=a,e.push(c),!0}function g(){return!1}for(var e=[];a._(b,f,g););return c(b,e)})},a.times=function(a,b){arguments.length<2&&(b=a);var d=this;return c(function(c,e,f){function k(a,b){return g.push(b),c=a,!0}function l(a,b){return i=b,c=a,!1}function m(a,b){return!1}for(var i,g=[],h=!0,j=0;j<a;j+=1)if(h=d._(c,k,l),!h)return f(c,i);for(;j<b&&h;j+=1)h=d._(c,k,m);return e(c,g)})},a.result=function(a){return this.then(g(a))},a.atMost=function(a){return this.times(0,a)},a.atLeast=function(a){var b=this;return b.times(a).then(function(a){return b.many().map(function(b){return a.concat(b)})})},a.map=function(a){return this.then(function(b){return g(a(b))})},a.skip=function(a){return this.then(function(b){return a.result(b)})};var f=(this.string=function(a){var b=a.length,d="expected '"+a+"'";return c(function(c,e,f){var g=c.slice(0,b);return g===a?e(c.slice(b),g):f(c,d)})},this.regex=function(a){m("regexp parser is anchored","^"===a.toString().charAt(1));var b="expected "+a;return c(function(c,d,e){var f=a.exec(c);if(f){var g=f[0];return d(c.slice(g.length),g)}return e(c,b)})}),g=c.succeed=function(a){return c(function(b,c){return c(b,a)})},r=(c.fail=function(a){return c(function(b,c,d){return d(b,a)})},c.letter=f(/^[a-z]/i),c.letters=f(/^[a-z]*/i),c.digit=f(/^[0-9]/),c.digits=f(/^[0-9]*/),c.whitespace=f(/^\s+/),c.optWhitespace=f(/^\s*/),c.any=c(function(a,b,c){return a?b(a.slice(1),a.charAt(0)):c(a,"expected any character")}),c.all=c(function(a,b,c){return b("",a)}),c.eof=c(function(a,b,c){return a?c(a,"expected EOF"):b(a,a)}))}),P=function(){function a(a){var b=V();return a.adopt(b,0,0),b}function b(a){for(var b=a[0]||V(),c=1;c<a.length;c+=1)a[c].children().adopt(b,b.ends[p],0);return b}var c=O.string,d=O.regex,e=O.letter,f=O.any,g=O.optWhitespace,h=O.succeed,i=O.fail,j=e.map(function(a){return Ha(a)}),k=d(/^[^${}\\_^]/).map(function(a){return T(a)}),l=d(/^[^\\a-eg-zA-Z]/).or(c("\\").then(d(/^[a-z]+/i).or(d(/^\s+/).result(" ")).or(f))).then(function(a){var b=w[a];return b?b(a).parser():i("unknown command: \\"+a)}),m=l.or(j).or(k),n=c("{").then(function(){return q}).skip(c("}")),o=g.then(n.or(m.map(a))),q=o.many().map(b).skip(g),r=c("[").then(o.then(function(a){return"]"!==a.join("latex")?h(a):i()}).many().map(b).skip(g)).skip(c("]")),s=q;return s.block=o,s.optBlock=r,s}();A.open(function(a,b){a.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},a.writeLatex=function(a){var b=this.notify("edit").cursor,c=O.all,d=O.eof,e=P.skip(d).or(c.result(!1)).parse(a);if(e&&!e.isEmpty()){e.children().adopt(b.parent,b[o],b[p]);var f=e.jQize();f.insertBefore(b.jQ),b[o]=e.ends[p],e.finalizeInsert(b.options,b),e.ends[p][p].siblingCreated&&e.ends[p][p].siblingCreated(b.options,o),e.ends[o][o].siblingCreated&&e.ends[o][o].siblingCreated(b.options,p),b.parent.bubble("reflow")}return this},a.renderLatexMath=function(a){var b=this.root,c=this.cursor,d=O.all,e=O.eof,f=P.skip(e).or(d.result(!1)).parse(a);b.eachChild("postOrder","dispose"),b.ends[o]=b.ends[p]=0,f&&f.children().adopt(b,0,0);var g=b.jQ;if(f){var h=f.join("html");g.html(h),b.jQize(g.children()),b.finalizeInsert(c.options)}else g.empty();delete c.selection,c.insAtRightEnd(b)},a.renderLatexText=function(a){var b=this.root,c=this.cursor;b.jQ.children().slice(1).remove(),b.eachChild("postOrder","dispose"),b.ends[o]=b.ends[p]=0,delete c.selection,c.show().insAtRightEnd(b);var d=O.regex,e=O.string,f=O.eof,g=O.all,h=e("$").then(P).skip(e("$").or(f)).map(function(a){var b=$(c);b.createBlocks();var d=b.ends[o];return a.children().adopt(d,0,0),b}),i=e("\\$").result("$"),j=i.or(d(/^[^$]/)).map(T),k=h.or(j).many(),l=k.skip(f).or(g.result(!1)).parse(a);if(l){for(var m=0;m<l.length;m+=1)l[m].adopt(b,b.ends[p],0);b.jQize().appendTo(b.jQ),b.finalizeInsert(c.options)}}}),A.open(function(a){a.focusBlurEvents=function(){function e(){clearTimeout(d),c.selection&&c.selection.jQ.addClass("mq-blur"),f()}function f(){c.hide().parent.blur(),a.container.removeClass("mq-focused"),r(window).unbind("blur",e)}var d,a=this,b=a.root,c=a.cursor;a.textarea.focus(function(){a.blurred=!1,clearTimeout(d),a.container.addClass("mq-focused"),c.parent||c.insAtRightEnd(b),c.selection?(c.selection.jQ.removeClass("mq-blur"),a.selectionChanged()):c.show()}).blur(function(){a.blurred=!0,d=setTimeout(function(){b.postOrder("intentionalBlur"),c.clearSelection().endSelection(),f()}),r(window).bind("blur",e)}),a.blurred=!0,c.hide().parent.blur()}}),A.open(function(a,b){a.exportText=function(){return this.root.foldChildren("",function(a,b){return a+b.text()})}}),A.open(function(a){a.keystroke=function(a,b){this.cursor.parent.keystroke(a,b,this)}}),t.open(function(a){a.keystroke=function(a,b,c){var d=c.cursor;switch(a){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":c.ctrlDeleteDir(o);break;case"Shift-Backspace":case"Backspace":c.backspace();break;case"Esc":case"Tab":return void c.escapeDir(p,a,b);case"Shift-Tab":case"Shift-Esc":return void c.escapeDir(o,a,b);case"End":c.notify("move").cursor.insAtRightEnd(d.parent);break;case"Ctrl-End":c.notify("move").cursor.insAtRightEnd(c.root);break;case"Shift-End":for(;d[p];)c.selectRight();break;case"Ctrl-Shift-End":for(;d[p]||d.parent!==c.root;)c.selectRight();break;case"Home":c.notify("move").cursor.insAtLeftEnd(d.parent);break;case"Ctrl-Home":c.notify("move").cursor.insAtLeftEnd(c.root);break;case"Shift-Home":for(;d[o];)c.selectLeft();break;case"Ctrl-Shift-Home":for(;d[o]||d.parent!==c.root;)c.selectLeft();break;case"Left":c.moveLeft();break;case"Shift-Left":c.selectLeft();break;case"Ctrl-Left":break;case"Right":c.moveRight();break;case"Shift-Right":c.selectRight();break;case"Ctrl-Right":break;case"Up":c.moveUp();break;case"Down":c.moveDown();break;case"Shift-Up":if(d[o])for(;d[o];)c.selectLeft();else c.selectLeft();case"Shift-Down":if(d[p])for(;d[p];)c.selectRight();else c.selectRight();case"Ctrl-Up":break;case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":c.ctrlDeleteDir(p);break;case"Shift-Del":case"Del":c.deleteForward();break;case"Meta-A":case"Ctrl-A":for(c.notify("move").cursor.insAtRightEnd(c.root);d[o];)c.selectLeft();break;default:return}b.preventDefault(),c.scrollHoriz()},a.moveOutOf=a.moveTowards=a.deleteOutOf=a.deleteTowards=a.unselectInto=a.selectOutOf=a.selectTowards=function(){m("overridden or never called on this node")}}),A.open(function(a){function b(a,b){var c=a.notify("upDown").cursor,d=b+"Into",e=b+"OutOf";return c[p][d]?c.insAtLeftEnd(c[p][d]):c[o][d]?c.insAtRightEnd(c[o][d]):c.parent.bubble(function(a){var b=a[e];if(b&&("function"==typeof b&&(b=a[e](c)),b instanceof t&&c.jumpUpDown(a,b),b!==!0))return!1}),a}this.onNotify(function(a){"move"!==a&&"upDown"!==a||this.show().clearSelection()}),a.escapeDir=function(a,b,c){q(a);var d=this.cursor;if(d.parent!==this.root&&c.preventDefault(),d.parent!==this.root)return d.parent.moveOutOf(a,d),this.notify("move")},D.leftRightIntoCmdGoes=function(a){if(a&&"up"!==a&&"down"!==a)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+a+'"';return a},a.moveDir=function(a){q(a);var b=this.cursor,c=b.options.leftRightIntoCmdGoes;return b.selection?b.insDirOf(a,b.selection.ends[a]):b[a]?b[a].moveTowards(a,b,c):b.parent.moveOutOf(a,b,c),this.notify("move")},a.moveLeft=function(){return this.moveDir(o)},a.moveRight=function(){return this.moveDir(p)},a.moveUp=function(){return b(this,"up")},a.moveDown=function(){return b(this,"down")},this.onNotify(function(a){"upDown"!==a&&(this.upDownCache={})}),this.onNotify(function(a){"edit"===a&&this.show().deleteSelection()}),a.deleteDir=function(a){q(a);var b=this.cursor,c=b.selection;return this.notify("edit"),c||(b[a]?b[a].deleteTowards(a,b):b.parent.deleteOutOf(a,b)),b[o].siblingDeleted&&b[o].siblingDeleted(b.options,p),b[p].siblingDeleted&&b[p].siblingDeleted(b.options,o),b.parent.bubble("reflow"),this},a.ctrlDeleteDir=function(a){q(a);var b=this.cursor;return!b[o]||b.selection?this.deleteDir():(this.notify("edit"),v(b.parent.ends[o],b[o]).remove(),b.insAtDirEnd(o,b.parent),b[o].siblingDeleted&&b[o].siblingDeleted(b.options,p),b[p].siblingDeleted&&b[p].siblingDeleted(b.options,o),b.parent.bubble("reflow"),this)},a.backspace=function(){return this.deleteDir(o)},a.deleteForward=function(){return this.deleteDir(p)},this.onNotify(function(a){"select"!==a&&this.endSelection()}),a.selectDir=function(a){var b=this.notify("select").cursor,c=b.selection;q(a),b.anticursor||b.startSelection();var d=b[a];d?c&&c.ends[a]===d&&b.anticursor[-a]!==d?d.unselectInto(a,b):d.selectTowards(a,b):b.parent.selectOutOf(a,b),b.clearSelection(),b.select()||b.show()},a.selectLeft=function(){return this.selectDir(o)},a.selectRight=function(){return this.selectDir(p)}}),A.open(function(a){C.p.substituteTextarea=function(){return r("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},a.createTextarea=function(){var a=this.textareaSpan=r('<span class="mq-textarea"></span>'),b=this.options.substituteTextarea();if(!b.nodeType)throw"substituteTextarea() must return a DOM element, got "+b;b=this.textarea=r(b).appendTo(a);var c=this;c.cursor.selectionChanged=function(){c.selectionChanged()},c.container.bind("copy",function(){c.setTextareaSelection()})},a.selectionChanged=function(){var a=this;ca(a.container[0]),a.textareaSelectionTimeout===b&&(a.textareaSelectionTimeout=setTimeout(function(){a.setTextareaSelection()}))},a.setTextareaSelection=function(){this.textareaSelectionTimeout=b;var a="";this.cursor.selection&&(a=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(a="$"+a+"$")),this.selectFn(a)},a.staticMathTextareaEvents=function(){function f(){e.detach(),a.blurred=!0}var a=this,c=(a.root,a.cursor),d=a.textarea,e=a.textareaSpan;this.container.prepend('<span class="mq-selectable">$'+a.exportLatex()+"$</span>"),a.blurred=!0,d.bind("cut paste",!1).bind("copy",function(){a.setTextareaSelection()}).focus(function(){a.blurred=!1}).blur(function(){c.selection&&c.selection.clear(),setTimeout(f)}),a.selectFn=function(a){d.val(a),a&&d.select()}},C.p.substituteKeyboardEvents=N,a.editablesTextareaEvents=function(){var a=this,b=a.textarea,c=a.textareaSpan,d=this.options.substituteKeyboardEvents(b,this);this.selectFn=function(a){d.select(a)},this.container.prepend(c),this.focusBlurEvents()},a.typedText=function(a){if("\n"===a)return this.handle("enter");var b=this.notify().cursor;b.parent.write(b,a),this.scrollHoriz()},a.cut=function(){var a=this,b=a.cursor;b.selection&&setTimeout(function(){a.notify("edit"),b.parent.bubble("reflow")})},a.copy=function(){this.setTextareaSelection()},a.paste=function(a){this.options.statelessClipboard&&(a="$"===a.slice(0,1)&&"$"===a.slice(-1)?a.slice(1,-1):"\\text{"+a+"}"),this.writeLatex(a).cursor.show()}}),A.open(function(a){C.p.ignoreNextMousedown=g,a.delegateMouseEvents=function(){var a=this.root.jQ;this.container.bind("mousedown.mathquill",function(c){function n(a){m=r(a.target)}function o(a){i.anticursor||i.startSelection(),h.seek(m,a.pageX,a.pageY).cursor.select(),m=b}function p(a){i.blink=j,i.selection||(h.editable?i.show():k.detach()),e.unbind("mousemove",n),r(a.target.ownerDocument).unbind("mousemove",o).unbind("mouseup",p)}var e=r(c.target).closest(".mq-root-block"),f=t.byId[e.attr(d)||a.attr(d)],h=f.controller,i=h.cursor,j=i.blink,k=h.textareaSpan,l=h.textarea;if(c.preventDefault(),c.target.unselectable=!0,!i.options.ignoreNextMousedown(c)){i.options.ignoreNextMousedown=g;var m;h.blurred&&(h.editable||e.prepend(k),l.focus()),i.blink=g,h.seek(r(c.target),c.pageX,c.pageY).cursor.startSelection(),e.mousemove(n),r(c.target.ownerDocument).mousemove(o).mouseup(p)}})}}),A.open(function(a){a.seek=function(a,b,e){var f=this.notify("select").cursor;if(a){var g=a.attr(d)||a.attr(c);if(!g){var h=a.parent();g=h.attr(d)||h.attr(c)}}var i=g?t.byId[g]:this.root;return m("nodeId is the id of some Node that exists",i),f.clearSelection().show(),i.seek(b,f),this.scrollHoriz(),this}}),A.open(function(a){a.scrollHoriz=function(){var a=this.cursor,b=a.selection,c=this.root.jQ[0].getBoundingClientRect();if(b){var f=b.jQ[0].getBoundingClientRect(),g=f.left-(c.left+20),h=f.right-(c.right-20);if(b.ends[o]===a[p])if(g<0)var e=g;else{if(!(h>0))return;if(f.left-h<c.left+20)var e=g;else var e=h}else if(h>0)var e=h;else{if(!(g<0))return;if(f.right-g>c.right-20)var e=h;else var e=g}}else{var d=a.jQ[0].getBoundingClientRect().left;if(d>c.right-20)var e=d-(c.right-20);else{if(!(d<c.left+20))return;var e=d-(c.left+20)}}this.root.jQ.stop().animate({scrollLeft:"+="+e},100)}});var Q=n(t,function(a,b){a.finalizeInsert=function(a,b){var c=this;c.postOrder("finalizeTree",a),c.postOrder("contactWeld",b),c.postOrder("blur"),c.postOrder("reflow"),c[p].siblingCreated&&c[p].siblingCreated(a,o),c[o].siblingCreated&&c[o].siblingCreated(a,p),c.bubble("reflow")}}),R=n(Q,function(a,b){a.init=function(a,c,d){var e=this;b.init.call(e),e.ctrlSeq||(e.ctrlSeq=a),c&&(e.htmlTemplate=c),d&&(e.textTemplate=d)},a.replaces=function(a){a.disown(),this.replacedFragment=a},a.isEmpty=function(){return this.foldChildren(!0,function(a,b){return a&&b.isEmpty()})},a.parser=function(){var a=P.block,b=this;return a.times(b.numBlocks()).map(function(a){b.blocks=a;for(var c=0;c<a.length;c+=1)a[c].adopt(b,b.ends[p],0);return b})},a.createLeftOf=function(a){var c=this,d=c.replacedFragment;c.createBlocks(),b.createLeftOf.call(c,a),d&&(d.adopt(c.ends[o],0,0),d.jQ.appendTo(c.ends[o].jQ)),c.finalizeInsert(a.options),c.placeCursor(a)},a.createBlocks=function(){for(var a=this,b=a.numBlocks(),c=a.blocks=Array(b),d=0;d<b;d+=1){var e=c[d]=V();e.adopt(a,a.ends[p],0)}},a.placeCursor=function(a){a.insAtRightEnd(this.foldChildren(this.ends[o],function(a,b){return a.isEmpty()?a:b}))},a.moveTowards=function(a,b,c){var d=c&&this[c+"Into"];b.insAtDirEnd(-a,d||this.ends[-a])},a.deleteTowards=function(a,b){this.isEmpty()?b[a]=this.remove()[a]:this.moveTowards(a,b,null)},a.selectTowards=function(a,b){b[-a]=this,b[a]=this[a]},a.selectChildren=function(){return z(this,this)},a.unselectInto=function(a,b){b.insAtDirEnd(-a,b.anticursor.ancestors[this.id])},a.seek=function(a,b){function c(a){var b={};return b[o]=a.jQ.offset().left,b[p]=b[o]+a.jQ.outerWidth(),b}var d=this,e=c(d);if(a<e[o])return b.insLeftOf(d);if(a>e[p])return b.insRightOf(d);var f=e[o];d.eachChild(function(g){var h=c(g);return a<h[o]?(a-f<h[o]-a?g[o]?b.insAtRightEnd(g[o]):b.insLeftOf(d):b.insAtLeftEnd(g),!1):a>h[p]?void(g[p]?f=h[p]:e[p]-a<a-h[p]?b.insRightOf(d):b.insAtRightEnd(g)):(g.seek(a,b),
!1)})},a.numBlocks=function(){var a=this.htmlTemplate.match(/&\d+/g);return a?a.length:0},a.html=function(){var a=this,b=a.blocks,c=" mathquill-command-id="+a.id,d=a.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);m("no unmatched angle brackets",d.join("")===this.htmlTemplate);for(var e=0,f=d[0];f;e+=1,f=d[e])if("/>"===f.slice(-2))d[e]=f.slice(0,-2)+c+"/>";else if("<"===f.charAt(0)){m("not an unmatched top-level close tag","/"!==f.charAt(1)),d[e]=f.slice(0,-1)+c+">";var g=1;do e+=1,f=d[e],m("no missing close tags",f),"</"===f.slice(0,2)?g-=1:"<"===f.charAt(0)&&"/>"!==f.slice(-2)&&(g+=1);while(g>0)}return d.join("").replace(/>&(\d+)/g,function(a,c){return" mathquill-block-id="+b[c].id+">"+b[c].join("html")})},a.latex=function(){return this.foldChildren(this.ctrlSeq,function(a,b){return a+"{"+(b.latex()||" ")+"}"})},a.textTemplate=[""],a.text=function(){var a=this,b=0;return a.foldChildren(a.textTemplate[b],function(c,d){b+=1;var e=d.text();return c&&"("===a.textTemplate[b]&&"("===e[0]&&")"===e.slice(-1)?c+e.slice(1,-1)+a.textTemplate[b]:c+d.text()+(a.textTemplate[b]||"")})}}),S=n(R,function(a,b){a.init=function(a,c,d){d||(d=a&&a.length>1?a.slice(1):a),b.init.call(this,a,c,[d])},a.parser=function(){return O.succeed(this)},a.numBlocks=function(){return 0},a.replaces=function(a){a.remove()},a.createBlocks=g,a.moveTowards=function(a,b){b.jQ.insDirOf(a,this.jQ),b[-a]=this,b[a]=this[a]},a.deleteTowards=function(a,b){b[a]=this.remove()[a]},a.seek=function(a,b){a-this.jQ.offset().left<this.jQ.outerWidth()/2?b.insLeftOf(this):b.insRightOf(this)},a.latex=function(){return this.ctrlSeq},a.text=function(){return this.textTemplate},a.placeCursor=g,a.isEmpty=function(){return!0}}),T=n(S,function(a,b){a.init=function(a,c){b.init.call(this,a,"<span>"+(c||a)+"</span>")}}),U=n(S,function(a,b){a.init=function(a,c,d){b.init.call(this,a,'<span class="mq-binary-operator">'+c+"</span>",d)}}),V=n(Q,function(a,b){a.join=function(a){return this.foldChildren("",function(b,c){return b+c[a]()})},a.html=function(){return this.join("html")},a.latex=function(){return this.join("latex")},a.text=function(){return this.ends[o]===this.ends[p]&&0!==this.ends[o]?this.ends[o].text():this.join("text")},a.keystroke=function(a,c,d){return!d.options.spaceBehavesLikeTab||"Spacebar"!==a&&"Shift-Spacebar"!==a?b.keystroke.apply(this,arguments):(c.preventDefault(),void d.escapeDir("Shift-Spacebar"===a?o:p,a,c))},a.moveOutOf=function(a,b,c){var d=c&&this.parent[c+"Into"];!d&&this[a]?b.insAtDirEnd(-a,this[a]):b.insDirOf(a,this.parent)},a.selectOutOf=function(a,b){b.insDirOf(a,this.parent)},a.deleteOutOf=function(a,b){b.unwrapGramp()},a.seek=function(a,b){var c=this.ends[p];if(!c||c.jQ.offset().left+c.jQ.outerWidth()<a)return b.insAtRightEnd(this);if(a<this.ends[o].jQ.offset().left)return b.insAtLeftEnd(this);for(;a<c.jQ.offset().left;)c=c[o];return c.seek(a,b)},a.chToCmd=function(a,b){var c;return a.match(/^[a-eg-zA-Z]$/)?Ha(a):/^\d$/.test(a)?Fa(a):b&&b.typingSlashWritesDivisionSymbol&&"/"===a?w["÷"](a):b&&b.typingAsteriskWritesTimesSymbol&&"*"===a?w["×"](a):(c=x[a]||w[a])?c(a):T(a)},a.write=function(a,b){var c=this.chToCmd(b,a.options);a.selection&&c.replaces(a.replaceSelection()),c.createLeftOf(a.show())},a.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},a.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}});B.StaticMath=function(a){return n(a.AbstractMathQuill,function(b,c){this.RootBlock=V,b.__mathquillify=function(a,b){return this.config(a),c.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},b.init=function(){c.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],a.MathField)},b.latex=function(){var b=c.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],a.MathField),b}})};var W=n(V,M);B.MathField=function(a){return n(a.EditableField,function(a,b){this.RootBlock=W,a.__mathquillify=function(a,c){return this.config(a),c>1&&(this.__controller.root.reflow=g),b.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})};var X=n(t,function(a,b){function c(a){a.jQ[0].normalize();var b=a.jQ[0].firstChild;if(b){m("only node in TextBlock span is Text node",3===b.nodeType);var c=Y(b.data);return c.jQadd(b),a.children().disown(),c.adopt(a,0,0)}}a.ctrlSeq="\\text",a.replaces=function(a){a instanceof v?this.replacedText=a.remove().jQ.text():"string"==typeof a&&(this.replacedText=a)},a.jQadd=function(a){b.jQadd.call(this,a),this.ends[o]&&this.ends[o].jQadd(this.jQ[0].firstChild)},a.createLeftOf=function(a){var c=this;if(b.createLeftOf.call(this,a),c[p].siblingCreated&&c[p].siblingCreated(a.options,o),c[o].siblingCreated&&c[o].siblingCreated(a.options,p),c.bubble("reflow"),a.insAtRightEnd(c),c.replacedText)for(var d=0;d<c.replacedText.length;d+=1)c.write(a,c.replacedText.charAt(d))},a.parser=function(){var a=this,b=O.string,c=O.regex,d=O.optWhitespace;return d.then(b("{")).then(c(/^[^}]*/)).skip(b("}")).map(function(b){return 0===b.length?v():(Y(b).adopt(a,0,0),a)})},a.textContents=function(){return this.foldChildren("",function(a,b){return a+b.text})},a.text=function(){return'"'+this.textContents()+'"'},a.latex=function(){var a=this.textContents();return 0===a.length?"":"\\text{"+a+"}"},a.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},a.moveTowards=function(a,b){b.insAtDirEnd(-a,this)},a.moveOutOf=function(a,b){b.insDirOf(a,this)},a.unselectInto=a.moveTowards,a.selectTowards=R.prototype.selectTowards,a.deleteTowards=R.prototype.deleteTowards,a.selectOutOf=function(a,b){b.insDirOf(a,this)},a.deleteOutOf=function(a,b){this.isEmpty()&&b.insRightOf(this)},a.write=function(a,c){if(a.show().deleteSelection(),"$"!==c)a[o]?a[o].appendText(c):Y(c).createLeftOf(a);else if(this.isEmpty())a.insRightOf(this),T("\\$","$").createLeftOf(a);else if(a[p])if(a[o]){var d=X(),e=this.ends[o];e.disown().jQ.detach(),e.adopt(d,0,0),a.insLeftOf(this),b.createLeftOf.call(d,a)}else a.insLeftOf(this);else a.insRightOf(this)},a.seek=function(a,b){b.hide();var d=c(this),e=this.jQ.width()/this.text.length,f=Math.round((a-this.jQ.offset().left)/e);f<=0?b.insAtLeftEnd(this):f>=d.text.length?b.insAtRightEnd(this):b.insLeftOf(d.splitRight(f));for(var g=a-b.show().offset().left,h=g&&g<0?o:p,i=h;b[h]&&g*i>0;)b[h].moveTowards(h,b),i=g,g=a-b.offset().left;if(h*g<-h*i&&b[-h].moveTowards(-h,b),b.anticursor){if(b.anticursor.parent===this){var j=b[o]&&b[o].text.length;if(this.anticursorPosition===j)b.anticursor=s.copy(b);else{if(this.anticursorPosition<j){var k=b[o].splitRight(this.anticursorPosition);b[o]=k}else var k=b[p].splitRight(this.anticursorPosition-j);b.anticursor=s(this,k[o],k)}}}else this.anticursorPosition=b[o]&&b[o].text.length},a.blur=function(a){V.prototype.blur.call(this),a&&(""===this.textContents()?(this.remove(),a[o]===this?a[o]=this[o]:a[p]===this&&(a[p]=this[p])):c(this))},a.focus=V.prototype.focus}),Y=n(t,function(a,b){function c(a,b){return b.charAt(a===o?0:-1+b.length)}a.init=function(a){b.init.call(this),this.text=a},a.jQadd=function(a){this.dom=a,this.jQ=r(a)},a.jQize=function(){return this.jQadd(document.createTextNode(this.text))},a.appendText=function(a){this.text+=a,this.dom.appendData(a)},a.prependText=function(a){this.text=a+this.text,this.dom.insertData(0,a)},a.insTextAtDirEnd=function(a,b){q(b),b===p?this.appendText(a):this.prependText(a)},a.splitRight=function(a){var b=Y(this.text.slice(a)).adopt(this.parent,this,this[p]);return b.jQadd(this.dom.splitText(a)),this.text=this.text.slice(0,a),b},a.moveTowards=function(a,b){q(a);var d=c(-a,this.text),e=this[-a];return e?e.insTextAtDirEnd(d,a):Y(d).createDir(-a,b),this.deleteTowards(a,b)},a.latex=function(){return this.text},a.deleteTowards=function(a,b){this.text.length>1?a===p?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),b[a]=this[a])},a.selectTowards=function(a,b){q(a);var d=b.anticursor,e=c(-a,this.text);if(d[a]===this){var f=Y(e).createDir(a,b);d[a]=f,b.insDirOf(a,f)}else{var g=this[-a];if(g)g.insTextAtDirEnd(e,a);else{var f=Y(e).createDir(-a,b);f.jQ.insDirOf(-a,b.selection.jQ)}1===this.text.length&&d[-a]===this&&(d[-a]=this[-a])}return this.deleteTowards(a,b)}});w.text=w.textnormal=w.textrm=w.textup=w.textmd=X,w.em=w.italic=w.italics=w.emph=w.textit=w.textsl=Z("\\textit","i",'class="mq-text-mode"'),w.strong=w.bold=w.textbf=Z("\\textbf","b",'class="mq-text-mode"'),w.sf=w.textsf=Z("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),w.tt=w.texttt=Z("\\texttt","span",'class="mq-monospace mq-text-mode"'),w.textsc=Z("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),w.uppercase=Z("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),w.lowercase=Z("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"');var $=n(R,function(a,b){a.init=function(a){b.init.call(this,"$"),this.cursor=a},a.htmlTemplate='<span class="mq-math-mode">&0</span>',a.createBlocks=function(){b.createBlocks.call(this),this.ends[o].cursor=this.cursor,this.ends[o].write=function(a,b){"$"!==b?V.prototype.write.call(this,a,b):this.isEmpty()?(a.insRightOf(this.parent),this.parent.deleteTowards(dir,a),T("\\$","$").createLeftOf(a.show())):a[p]?a[o]?V.prototype.write.call(this,a,b):a.insLeftOf(this.parent):a.insRightOf(this.parent)}},a.latex=function(){return"$"+this.ends[o].latex()+"$"}}),_=n(W,function(a,b){a.keystroke=function(a){if("Spacebar"!==a&&"Shift-Spacebar"!==a)return b.keystroke.apply(this,arguments)},a.write=function(a,b){if(a.show().deleteSelection(),"$"===b)$(a).createLeftOf(a);else{var c;"<"===b?c="&lt;":">"===b&&(c="&gt;"),T(b,c).createLeftOf(a)}}});B.TextField=function(a){return n(a.EditableField,function(a,b){this.RootBlock=_,a.__mathquillify=function(){return b.__mathquillify.call(this,"mq-editable-field mq-text-mode")},a.latex=function(a){return arguments.length>0?(this.__controller.renderLatexText(a),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})};var ba,ga,ca=(x["\\"]=n(R,function(a,b){a.ctrlSeq="\\",a.replaces=function(a){this._replacedFragment=a.disown(),this.isEmpty=function(){return!1}},a.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',a.textTemplate=["\\"],a.createBlocks=function(){b.createBlocks.call(this),this.ends[o].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[o].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[o].write=function(a,b){a.show().deleteSelection(),b.match(/[a-z]/i)?T(b).createLeftOf(a):(this.parent.renderCommand(a),"\\"===b&&this.isEmpty()||this.parent.parent.write(a,b))},this.ends[o].keystroke=function(a,c,d){return"Tab"===a||"Enter"===a||"Spacebar"===a?(this.parent.renderCommand(d.cursor),void c.preventDefault()):b.keystroke.apply(this,arguments)}},a.createLeftOf=function(a){if(b.createLeftOf.call(this,a),this._replacedFragment){var c=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(a){return r(a.target=c).trigger(a),!1}).insertBefore(this.jQ).add(this.jQ)}},a.latex=function(){return"\\"+this.ends[o].latex()+" "},a.renderCommand=function(a){this.jQ=this.jQ.last(),this.remove(),this[p]?a.insLeftOf(this[p]):a.insAtRightEnd(this.parent);var b=this.ends[o].latex();b||(b=" ");var c=w[b]||Ba[b];c?(c=c(b),this._replacedFragment&&c.replaces(this._replacedFragment),c.createLeftOf(a)):(c=X(),c.replaces(b),c.createLeftOf(a),a.insRightOf(c),this._replacedFragment&&this._replacedFragment.remove())}}),g),da=document.createElement("div"),ea=da.style,fa={transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1};for(var ha in fa)if(ha in ea){ga=ha;break}ga?ba=function(a,b,c){a.css(ga,"scale("+b+","+c+")")}:"filter"in ea?(ca=function(a){a.className=a.className},ba=function(a,b,c){function e(){a.css("marginRight",(d.width()-1)*(b-1)/b+"px")}b/=1+(c-1)/2,a.css("fontSize",c+"em"),a.hasClass("mq-matrixed-container")||a.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>');var d=a.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+b+",SizingMethod='auto expand')");e();var f=setInterval(e);r(window).load(function(){clearTimeout(f),e()})}):ba=function(a,b,c){a.css("fontSize",c+"em")};var ia=n(R,function(a,b){a.init=function(a,c,d){b.init.call(this,a,"<"+c+" "+d+">&0</"+c+">")}});w.mathrm=l(ia,"\\mathrm","span",'class="mq-roman mq-font"'),w.mathit=l(ia,"\\mathit","i",'class="mq-font"'),w.mathbf=l(ia,"\\mathbf","b",'class="mq-font"'),w.mathsf=l(ia,"\\mathsf","span",'class="mq-sans-serif mq-font"'),w.mathtt=l(ia,"\\mathtt","span",'class="mq-monospace mq-font"'),w.underline=l(ia,"\\underline","span",'class="mq-non-leaf mq-underline"'),w.overline=w.bar=l(ia,"\\overline","span",'class="mq-non-leaf mq-overline"'),w.overrightarrow=l(ia,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),w.overleftarrow=l(ia,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"');var la=(w.textcolor=n(R,function(a,b){a.setColor=function(a){this.color=a,this.htmlTemplate='<span class="mq-textcolor" style="color:'+a+'">&0</span>'},a.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},a.parser=function(){var a=this,c=O.optWhitespace,d=O.string,e=O.regex;return c.then(d("{")).then(e(/^[#\w\s.,()%-]*/)).skip(d("}")).then(function(c){return a.setColor(c),b.parser.call(a)})},a.isStyleBlock=function(){return!0}}),w.class=n(R,function(a,b){a.parser=function(){var a=this,c=O.string,d=O.regex;return O.optWhitespace.then(c("{")).then(d(/^[-\w\s\\\xA0-\xFF]*/)).skip(c("}")).then(function(c){return a.cls=c||"",a.htmlTemplate='<span class="mq-class '+c+'">&0</span>',b.parser.call(a)})},a.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},a.isStyleBlock=function(){return!0}}),n(R,function(a,b){a.ctrlSeq="_{...}^{...}",a.createLeftOf=function(a){if(this.replacedFragment||a[o]||!a.options.supSubsRequireOperand)return b.createLeftOf.apply(this,arguments)},a.contactWeld=function(a){for(var b=o;b;b=b===o&&p)if(this[b]instanceof la){for(var c="sub";c;c="sub"===c&&"sup"){var d=this[c],e=this[b][c];if(d){if(e)if(d.isEmpty())var g=s(e,0,e.ends[o]);else{d.jQ.children().insAtDirEnd(-b,e.jQ);var f=d.children().disown(),g=s(e,f.ends[p],e.ends[o]);b===o?f.adopt(e,e.ends[p],0):f.adopt(e,0,e.ends[o])}else this[b].addBlock(d.disown());this.placeCursor=function(a,c){return function(d){d.insAtDirEnd(-b,a||c)}}(e,d)}}this.remove(),a&&a[o]===this&&(b===p&&g?g[o]?a.insRightOf(g[o]):a.insAtLeftEnd(g.parent):a.insRightOf(this[b]));break}},C.p.charsThatBreakOutOfSupSub="",a.finalizeTree=function(){this.ends[o].write=function(a,b){if(a.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===b)return;var c=this.chToCmd(b,a.options);return c instanceof S?a.deleteSelection():a.clearSelection().insRightOf(this.parent),c.createLeftOf(a.show())}a[o]&&!a[p]&&!a.selection&&a.options.charsThatBreakOutOfSupSub.indexOf(b)>-1&&a.insRightOf(this.parent),V.p.write.apply(this,arguments)}},a.moveTowards=function(a,c,d){c.options.autoSubscriptNumerals&&!this.sup?c.insDirOf(a,this):b.moveTowards.apply(this,arguments)},a.deleteTowards=function(a,c){if(c.options.autoSubscriptNumerals&&this.sub){var d=this.sub.ends[-a];d instanceof S?d.remove():d&&d.deleteTowards(a,c.insAtDirEnd(-a,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(o,c.insAtLeftEnd(this.sub)),this.sup&&c.insDirOf(-a,this))}else b.deleteTowards.apply(this,arguments)},a.latex=function(){function a(a,b){var c=b&&b.latex();return b?a+(1===c.length?c:"{"+(c||" ")+"}"):""}return a("_",this.sub)+a("^",this.sup)},a.addBlock=function(a){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=a,a.adopt(this,this.sub,0).downOutOf=this.sub,a.jQ=r('<span class="mq-sup"/>').append(a.jQ.children()).attr(d,a.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=a,a.adopt(this,0,this.sup).upOutOf=this.sup,a.jQ=r('<span class="mq-sub"></span>').append(a.jQ.children()).attr(d,a.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var b=0;b<2;b+=1)(function(a,b,c,d){a[b].deleteOutOf=function(e,f){if(f.insDirOf(this[e]?-e:e,this.parent),!this.isEmpty()){var g=this.ends[e];this.children().disown().withDirAdopt(e,f.parent,f[e],f[-e]).jQ.insDirOf(-e,f.jQ),f[-e]=g}a.supsub=c,delete a[b],delete a[d+"Into"],a[c][d+"OutOf"]=ma,delete a[c].deleteOutOf,"sub"===b&&r(a.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}})(this,"sub sup".split(" ")[b],"sup sub".split(" ")[b],"down up".split(" ")[b])}}));w.subscript=w._=n(la,function(a,b){a.supsub="sub",a.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',a.textTemplate=["_"],a.finalizeTree=function(){this.downInto=this.sub=this.ends[o],this.sub.upOutOf=ma,b.finalizeTree.call(this)}}),w.superscript=w.supscript=w["^"]=n(la,function(a,b){a.supsub="sup",a.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',a.textTemplate=["^"],a.finalizeTree=function(){this.upInto=this.sup=this.ends[p],this.sup.downOutOf=ma,b.finalizeTree.call(this)}});var na=n(R,function(a,b){a.init=function(a,b){var c='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+b+'</big><span class="mq-from"><span>&0</span></span></span>';S.prototype.init.call(this,a,c)},a.createLeftOf=function(a){b.createLeftOf.apply(this,arguments),a.options.sumStartsWithNEquals&&(Ha("n").createLeftOf(a),Ta().createLeftOf(a))},a.latex=function(){function a(a){return 1===a.length?a:"{"+(a||" ")+"}"}return this.ctrlSeq+"_"+a(this.ends[o].latex())+"^"+a(this.ends[p].latex())},a.parser=function(){for(var a=O.string,b=O.optWhitespace,c=O.succeed,d=P.block,e=this,f=e.blocks=[V(),V()],g=0;g<f.length;g+=1)f[g].adopt(e,e.ends[p],0);return b.then(a("_").or(a("^"))).then(function(a){var b=f["_"===a?0:1];return d.then(function(a){return a.children().adopt(b,b.ends[p],0),c(e)})}).many().result(e)},a.finalizeTree=function(){this.downInto=this.ends[o],this.upInto=this.ends[p],this.ends[o].upOutOf=this.ends[p],this.ends[p].downOutOf=this.ends[o]}});w["∑"]=w.sum=w.summation=l(na,"\\sum ","&sum;"),w["∏"]=w.prod=w.product=l(na,"\\prod ","&prod;"),w.coprod=w.coproduct=l(na,"\\coprod ","&#8720;"),w["∫"]=w.int=w.integral=n(na,function(a,b){a.init=function(){var a='<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>';S.prototype.init.call(this,"\\int ",a)},a.createLeftOf=R.p.createLeftOf});var oa=w.frac=w.dfrac=w.cfrac=w.fraction=n(R,function(a,b){a.ctrlSeq="\\frac",a.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',a.textTemplate=["(",")/(",")"],a.finalizeTree=function(){this.upInto=this.ends[p].upOutOf=this.ends[o],this.downInto=this.ends[o].downOutOf=this.ends[p]}}),pa=w.over=x["/"]=n(oa,function(a,b){a.createLeftOf=function(a){if(!this.replacedFragment){for(var c=a[o];c&&!(c instanceof U||c instanceof(w.text||g)||c instanceof na||"\\ "===c.ctrlSeq||/^[,;:]$/.test(c.ctrlSeq));)c=c[o];c instanceof na&&c[p]instanceof la&&(c=c[p],c[p]instanceof la&&c[p].ctrlSeq!=c.ctrlSeq&&(c=c[p])),c!==a[o]&&(this.replaces(v(c[p]||a.parent.ends[o],a[o])),a[o]=c)}b.createLeftOf.call(this,a)}}),qa=w.sqrt=w["√"]=n(R,function(a,b){a.ctrlSeq="\\sqrt",a.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',a.textTemplate=["sqrt(",")"],a.parser=function(){return P.optBlock.then(function(a){return P.block.map(function(b){var c=sa();return c.blocks=[a,b],a.adopt(c,0,0),b.adopt(c,a,0),c})}).or(b.parser.call(this))},a.reflow=function(){var a=this.ends[p].jQ;ba(a.prev(),1,a.innerHeight()/+a.css("fontSize").slice(0,-2)-.1)}}),sa=(w.hat=n(R,function(a,b){a.ctrlSeq="\\hat",a.htmlTemplate='<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',a.textTemplate=["hat(",")"]}),w.nthroot=n(qa,function(a,b){a.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',a.textTemplate=["sqrt[","](",")"],a.latex=function(){return"\\sqrt["+this.ends[o].latex()+"]{"+this.ends[p].latex()+"}"}})),ta=n(R,function(a,b){a.init=function(a,c,d){var e='<span class="mq-non-leaf"><span class="mq-diacritic-above">'+c+'</span><span class="mq-diacritic-stem">&0</span></span>';b.init.call(this,a,e,d)}});w.vec=l(ta,"\\vec","&rarr;",["vec(",")"]),w.tilde=l(ta,"\\tilde","~",["tilde(",")"]);var va=n(n(R,ua),function(a,c){a.init=function(a,d,e,f,g){c.init.call(this,"\\left"+f,b,[d,e]),this.side=a,this.sides={},this.sides[o]={ch:d,ctrlSeq:f},this.sides[p]={ch:e,ctrlSeq:g}},a.numBlocks=function(){return 1},a.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===p?" mq-ghost":"")+'">'+this.sides[o].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===o?" mq-ghost":"")+'">'+this.sides[p].ch+"</span></span>",c.html.call(this)},a.latex=function(){return"\\left"+this.sides[o].ctrlSeq+this.ends[o].latex()+"\\right"+this.sides[p].ctrlSeq},a.matchBrack=function(a,b,c){return c instanceof va&&c.side&&c.side!==-b&&("|"===this.sides[this.side].ch||c.side===-this.side)&&(!a.restrictMismatchedBrackets||wa[this.sides[this.side].ch]===c.sides[c.side].ch||{"(":"]","[":")"}[this.sides[o].ch]===c.sides[p].ch)&&c},a.closeOpposing=function(a){a.side=0,a.sides[this.side]=this.sides[this.side],a.delimjQs.eq(this.side===o?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},a.createLeftOf=function(a){if(!this.replacedFragment){var b=a.options;if("|"===this.sides[o].ch)var d=this.matchBrack(b,p,a[p])||this.matchBrack(b,o,a[o])||this.matchBrack(b,0,a.parent.parent);else var d=this.matchBrack(b,-this.side,a[-this.side])||this.matchBrack(b,-this.side,a.parent.parent)}if(d){var e=this.side=-d.side;this.closeOpposing(d),d===a.parent.parent&&a[e]&&v(a[e],a.parent.ends[e],-e).disown().withDirAdopt(-e,d.parent,d,d[e]).jQ.insDirOf(e,d.jQ),d.bubble("reflow")}else d=this,e=d.side,d.replacedFragment?d.side=0:a[-e]&&(d.replaces(v(a[-e],a.parent.ends[-e],e)),a[-e]=0),c.createLeftOf.call(d,a);e===o?a.insAtLeftEnd(d.ends[o]):a.insRightOf(d)},a.placeCursor=g,a.unwrap=function(){this.ends[o].children().disown().adopt(this.parent,this,this[p]).jQ.insertAfter(this.jQ),this.remove()},a.deleteSide=function(a,b,c){var d=this.parent,e=this[a],f=d.ends[a];if(a===this.side)return this.unwrap(),void(e?c.insDirOf(-a,e):c.insAtDirEnd(a,d));var g=c.options,h=!this.side;if(this.side=-a,this.matchBrack(g,a,this.ends[o].ends[this.side])){this.closeOpposing(this.ends[o].ends[this.side]);var i=this.ends[o].ends[a];this.unwrap(),i.siblingCreated&&i.siblingCreated(c.options,a),e?c.insDirOf(-a,e):c.insAtDirEnd(a,d)}else{if(this.matchBrack(g,a,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(b&&h)return this.unwrap(),void(e?c.insDirOf(-a,e):c.insAtDirEnd(a,d));this.sides[a]={ch:wa[this.sides[this.side].ch],ctrlSeq:wa[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(a===o?0:1).addClass("mq-ghost").html(this.sides[a].ch)}if(e){var i=this.ends[o].ends[a];v(e,f,-a).disown().withDirAdopt(-a,this.ends[o],i,0).jQ.insAtDirEnd(a,this.ends[o].jQ.removeClass("mq-empty")),i.siblingCreated&&i.siblingCreated(c.options,a),c.insDirOf(-a,e)}else b?c.insDirOf(a,this):c.insAtDirEnd(a,this.ends[o])}},a.deleteTowards=function(a,b){this.deleteSide(-a,!1,b)},a.finalizeTree=function(){this.ends[o].deleteOutOf=function(a,b){this.parent.deleteSide(a,!0,b)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===o?1:0).removeClass("mq-ghost"),this.side=0}},a.siblingCreated=function(a,b){b===-this.side&&this.finalizeTree()}}),wa={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "};xa("("),xa("["),xa("{","\\{"),w.langle=l(va,o,"&lang;","&rang;","\\langle ","\\rangle "),w.rangle=l(va,p,"&lang;","&rang;","\\langle ","\\rangle "),x["|"]=l(va,o,"|","|","|","|"),w.lVert=l(va,o,"&#8741;","&#8741;","\\lVert ","\\rVert "),w.rVert=l(va,p,"&#8741;","&#8741;","\\lVert ","\\rVert "),w.left=n(R,function(a){a.parser=function(){var a=O.regex,b=O.string,d=(O.succeed,O.optWhitespace);return d.then(a(/^(?:[([|]|\\\{|\\langle\b|\\lVert\b)/)).then(function(c){var e="\\"===c.charAt(0)?c.slice(1):c;return"\\langle"==c&&(e="&lang;",c+=" "),"\\lVert"==c&&(e="&#8741;",c+=" "),P.then(function(f){return b("\\right").skip(d).then(a(/^(?:[\])|]|\\\}|\\rangle\b|\\rVert\b)/)).map(function(a){var b="\\"===a.charAt(0)?a.slice(1):a;"\\rangle"==a&&(b="&rang;",a+=" "),"\\rVert"==a&&(b="&#8741;",a+=" ");var d=va(0,e,b,c,a);return d.blocks=[f],f.adopt(d,0,0),d})})})}}),w.right=n(R,function(a){a.parser=function(){return O.fail("unmatched \\right")}});var ya=w.binom=w.binomial=n(n(R,ua),function(a,b){a.ctrlSeq="\\binom",a.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',a.textTemplate=["choose(",",",")"]});w.choose=n(ya,function(a){a.createLeftOf=pa.prototype.createLeftOf});w.editable=w.MathQuillMathField=n(R,function(a,b){a.ctrlSeq="\\MathQuillMathField",a.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',a.parser=function(){var a=this,c=O.string,d=O.regex,e=O.succeed;return c("[").then(d(/^[a-z][a-z0-9]*/i)).skip(c("]")).map(function(b){a.name=b}).or(e()).then(b.parser.call(a))},a.finalizeTree=function(a){var b=A(this.ends[o],this.jQ,a);b.KIND_OF_MQ="MathField",b.editable=!0,b.createTextarea(),b.editablesTextareaEvents(),b.cursor.insAtRightEnd(b.root),M(b.root)},a.registerInnerField=function(a,b){a.push(a[this.name]=b(this.ends[o].controller))},a.latex=function(){return this.ends[o].latex()},a.text=function(){return this.ends[o].text()}});var Aa=w.embed=n(S,function(a,b){a.setOptions=function(a){function b(){return""}return this.text=a.text||b,this.htmlTemplate=a.htmlString||"",this.latex=a.latex||b,this},a.parser=function(){var a=this,b=O.string,c=O.regex,d=O.succeed;return b("{").then(c(/^[a-z][a-z0-9]*/i)).skip(b("}")).then(function(e){return b("[").then(c(/^[-\w\s]*/)).skip(b("]")).or(d()).map(function(b){return a.setOptions(F[e](b))})})}}),Ba={};w.begin=n(R,function(a,b){a.parser=function(){var a=O.string,b=O.regex;return a("{").then(b(/^[a-z]+/i)).skip(a("}")).then(function(b){return(Ba[b]?Ba[b]().parser():O.fail("unknown environment type: "+b)).skip(a("\\end{"+b+"}"))})}});var Ca=n(R,function(a,b){a.template=[["\\begin{","}"],["\\end{","}"]],a.wrappers=function(){return[a.template[0].join(this.environment),a.template[1].join(this.environment)]}}),Da=Ba.matrix=n(Ca,function(a,b){var c={column:"&",row:"\\\\"};a.parentheses={left:null,right:null},a.environment="matrix",a.reflow=function(){var a=this.jQ.children("table"),b=a.outerHeight()/+a.css("fontSize").slice(0,-2),c=this.jQ.children(".mq-paren");c.length&&ba(c,e(1+.2*(b-1),1.2),1.05*b)},a.latex=function(){var b,a="";return this.eachChild(function(d){"undefined"!=typeof b&&(a+=b!==d.row?c.row:c.column),b=d.row,a+=d.latex()}),this.wrappers().join(a)},a.html=function(){function f(a){return a?'<span class="mq-scaled mq-paren">'+a+"</span>":""}var e,a=[],c="",d=0;return this.eachChild(function(b){e!==b.row&&(e=b.row,c+="<tr>$tds</tr>",a[e]=[]),a[e].push("<td>&"+d++ +"</td>")}),this.htmlTemplate='<span class="mq-matrix mq-non-leaf">'+f(this.parentheses.left)+'<table class="mq-non-leaf">'+c.replace(/\$tds/g,function(){return a.shift().join("")})+"</table>"+f(this.parentheses.right)+"</span>",b.html.call(this)},a.createBlocks=function(){this.blocks=[Ea(0,this),Ea(0,this),Ea(1,this),Ea(1,this)]},a.parser=function(){var a=this,b=O.optWhitespace,d=O.string;return b.then(d(c.column).or(d(c.row)).or(P.block)).many().skip(b).then(function(b){function f(){a.blocks.push(Ea(e,a,d)),d=[]}var d=[],e=0;a.blocks=[];for(var g=0;g<b.length;g+=1)b[g]instanceof V?d.push(b[g]):(f(),b[g]===c.row&&(e+=1));return f(),a.autocorrect(),O.succeed(a)})},a.finalizeTree=function(){var a=this.jQ.find("table");a.toggleClass("mq-rows-1",1===a.find("tr").length),this.relink()},a.relink=function(){for(var c,d,e,a=this.blocks,b=[],f=0;f<a.length;f+=1)e=a[f],c!==e.row&&(c=e.row,b[c]=[],d=0),b[c][d]=e,e[p]=a[f+1],e[o]=a[f-1],b[c-1]&&b[c-1][d]&&(e.upOutOf=b[c-1][d],b[c-1][d].downOutOf=e),d+=1;this.ends[o]=a[0],this.ends[p]=a[a.length-1]},a.autocorrect=function(a){var d,e,f,g,h,b=[],a=[],c=this.blocks;for(h=0;h<c.length;h+=1)g=c[h].row,a[g]=a[g]||[],a[g].push(c[h]),b[g]=a[g].length;if(d=Math.max.apply(null,b),d!==Math.min.apply(null,b)){for(h=0;h<a.length;h+=1)for(e=d-a[h].length;e;)f=d*h+a[h].length,c.splice(f,0,Ea(h,this)),e-=1;this.relink()}},a.deleteCell=function(a){function i(a){for(var b=[],c=0;c<a.length;c+=1)a[c].isEmpty()&&b.push(a[c]);return b.length===a.length}function j(a){for(var b=0;b<a.length;b+=1)f.indexOf(a[b])>-1&&(a[b].remove(),f.splice(f.indexOf(a[b]),1))}var g,h,b=[],c=[],d=[],e=[],f=this.blocks;this.eachChild(function(f){g!==f.row&&(g=f.row,b[g]=[],h=0),c[h]=c[h]||[],c[h].push(f),b[g].push(f),f===a&&(d=b[g],e=c[h]),h+=1}),i(d)&&e.length>1&&(g=b.indexOf(d),this.eachChild(function(a){a.row>g&&(a.row-=1)}),j(d),this.jQ.find("tr").eq(g).remove()),i(e)&&d.length>1&&j(e),this.finalizeTree()},a.addRow=function(a){var i,j,b=[],c=[],e=[],f=r("<tr></tr>"),g=a.row,h=0;this.eachChild(function(c){c.row<=g&&b.push(c),c.row===g&&(c===a&&(j=h),h+=1),c.row>g&&(c.row+=1,e.push(c))});for(var k=0;k<h;k+=1)i=Ea(g+1),i.parent=this,c.push(i),i.jQ=r('<td class="mq-empty">').attr(d,i.id).appendTo(f);return this.jQ.find("tr").eq(g).after(f),this.blocks=b.concat(c,e),c[j]},a.addColumn=function(a){var e,f,b=[],c=[];this.eachChild(function(c){b[c.row]=b[c.row]||[],b[c.row].push(c),c===a&&(e=b[c.row].length)});for(var g=0;g<b.length;g+=1)f=Ea(g),f.parent=this,c.push(f),b[g].splice(e,0,f),f.jQ=r('<td class="mq-empty">').attr(d,f.id);return this.jQ.find("tr").each(function(a){r(this).find("td").eq(e-1).after(b[a][e].jQ)}),this.blocks=[].concat.apply([],b),c[a.row]},a.insert=function(a,b){var c=this[a](b);this.cursor=this.cursor||this.parent.cursor,this.finalizeTree(),this.bubble("reflow").cursor.insAtRightEnd(c)},a.backspace=function(a,b,c,d){var e=a[b];if(a.isEmpty()){for(this.deleteCell(a);e&&e[b]&&this.blocks.indexOf(e)===-1;)e=e[b];e&&c.insAtDirEnd(-b,e),1===this.blocks.length&&this.blocks[0].isEmpty()&&(d(),this.finalizeTree()),this.bubble("edited")}}});Ba.pmatrix=n(Da,function(a,b){a.environment="pmatrix",a.parentheses={left:"(",right:")"}}),Ba.bmatrix=n(Da,function(a,b){a.environment="bmatrix",a.parentheses={left:"[",right:"]"}}),Ba.Bmatrix=n(Da,function(a,b){a.environment="Bmatrix",a.parentheses={left:"{",right:"}"}}),Ba.vmatrix=n(Da,function(a,b){
a.environment="vmatrix",a.parentheses={left:"|",right:"|"}}),Ba.Vmatrix=n(Da,function(a,b){a.environment="Vmatrix",a.parentheses={left:"&#8214;",right:"&#8214;"}});var Ea=n(V,function(a,b){a.init=function(a,c,d){if(b.init.call(this),this.row=a,c&&this.adopt(c,c.ends[p],0),d)for(var e=0;e<d.length;e++)d[e].children().adopt(this,this.ends[p],0)},a.keystroke=function(a,c,d){switch(a){case"Shift-Spacebar":return c.preventDefault(),this.parent.insert("addColumn",this);case"Shift-Enter":return this.parent.insert("addRow",this)}return b.keystroke.apply(this,arguments)},a.deleteOutOf=function(a,c){var d=this,e=arguments;this.parent.backspace(this,a,c,function(){return b.deleteOutOf.apply(d,e)})}});w.notin=w.cong=w.equiv=w.oplus=w.otimes=n(U,function(a,b){a.init=function(a){b.init.call(this,"\\"+a+" ","&"+a+";")}}),w["≠"]=w.ne=w.neq=l(U,"\\ne ","&ne;"),w["∗"]=w.ast=w.star=w.loast=w.lowast=l(U,"\\ast ","&lowast;"),w.therefor=w.therefore=l(U,"\\therefore ","&there4;"),w.cuz=w.because=l(U,"\\because ","&#8757;"),w.prop=w.propto=l(U,"\\propto ","&prop;"),w["≈"]=w.asymp=w.approx=l(U,"\\approx ","&asymp;"),w.isin=w.in=l(U,"\\in ","&isin;"),w.ni=w.contains=l(U,"\\ni ","&ni;"),w.notni=w.niton=w.notcontains=w.doesnotcontain=l(U,"\\not\\ni ","&#8716;"),w.sub=w.subset=l(U,"\\subset ","&sub;"),w.sup=w.supset=w.superset=l(U,"\\supset ","&sup;"),w.nsub=w.notsub=w.nsubset=w.notsubset=l(U,"\\not\\subset ","&#8836;"),w.nsup=w.notsup=w.nsupset=w.notsupset=w.nsuperset=w.notsuperset=l(U,"\\not\\supset ","&#8837;"),w.sube=w.subeq=w.subsete=w.subseteq=l(U,"\\subseteq ","&sube;"),w.supe=w.supeq=w.supsete=w.supseteq=w.supersete=w.superseteq=l(U,"\\supseteq ","&supe;"),w.nsube=w.nsubeq=w.notsube=w.notsubeq=w.nsubsete=w.nsubseteq=w.notsubsete=w.notsubseteq=l(U,"\\not\\subseteq ","&#8840;"),w.nsupe=w.nsupeq=w.notsupe=w.notsupeq=w.nsupsete=w.nsupseteq=w.notsupsete=w.notsupseteq=w.nsupersete=w.nsuperseteq=w.notsupersete=w.notsuperseteq=l(U,"\\not\\supseteq ","&#8841;"),w.N=w.naturals=w.Naturals=l(T,"\\mathbb{N}","&#8469;"),w.P=w.primes=w.Primes=w.projective=w.Projective=w.probability=w.Probability=l(T,"\\mathbb{P}","&#8473;"),w.Z=w.integers=w.Integers=l(T,"\\mathbb{Z}","&#8484;"),w.Q=w.rationals=w.Rationals=l(T,"\\mathbb{Q}","&#8474;"),w.R=w.reals=w.Reals=l(T,"\\mathbb{R}","&#8477;"),w.C=w.complex=w.Complex=w.complexes=w.Complexes=w.complexplane=w.Complexplane=w.ComplexPlane=l(T,"\\mathbb{C}","&#8450;"),w.H=w.Hamiltonian=w.quaternions=w.Quaternions=l(T,"\\mathbb{H}","&#8461;"),w.quad=w.emsp=l(T,"\\quad ","    "),w.qquad=l(T,"\\qquad ","        "),w.diamond=l(T,"\\diamond ","&#9671;"),w.bigtriangleup=l(T,"\\bigtriangleup ","&#9651;"),w.ominus=l(T,"\\ominus ","&#8854;"),w.uplus=l(T,"\\uplus ","&#8846;"),w.bigtriangledown=l(T,"\\bigtriangledown ","&#9661;"),w.sqcap=l(T,"\\sqcap ","&#8851;"),w.triangleleft=l(T,"\\triangleleft ","&#8882;"),w.sqcup=l(T,"\\sqcup ","&#8852;"),w.triangleright=l(T,"\\triangleright ","&#8883;"),w.odot=w.circledot=l(T,"\\odot ","&#8857;"),w.bigcirc=l(T,"\\bigcirc ","&#9711;"),w.dagger=l(T,"\\dagger ","&#0134;"),w.ddagger=l(T,"\\ddagger ","&#135;"),w.wr=l(T,"\\wr ","&#8768;"),w.amalg=l(T,"\\amalg ","&#8720;"),w.models=l(T,"\\models ","&#8872;"),w.prec=l(T,"\\prec ","&#8826;"),w.succ=l(T,"\\succ ","&#8827;"),w.preceq=l(T,"\\preceq ","&#8828;"),w.succeq=l(T,"\\succeq ","&#8829;"),w.simeq=l(T,"\\simeq ","&#8771;"),w.mid=l(T,"\\mid ","&#8739;"),w.ll=l(T,"\\ll ","&#8810;"),w.gg=l(T,"\\gg ","&#8811;"),w.parallel=l(T,"\\parallel ","&#8741;"),w.nparallel=l(T,"\\nparallel ","&#8742;"),w.bowtie=l(T,"\\bowtie ","&#8904;"),w.sqsubset=l(T,"\\sqsubset ","&#8847;"),w.sqsupset=l(T,"\\sqsupset ","&#8848;"),w.smile=l(T,"\\smile ","&#8995;"),w.sqsubseteq=l(T,"\\sqsubseteq ","&#8849;"),w.sqsupseteq=l(T,"\\sqsupseteq ","&#8850;"),w.doteq=l(T,"\\doteq ","&#8784;"),w.frown=l(T,"\\frown ","&#8994;"),w.vdash=l(T,"\\vdash ","&#8870;"),w.dashv=l(T,"\\dashv ","&#8867;"),w.nless=l(T,"\\nless ","&#8814;"),w.ngtr=l(T,"\\ngtr ","&#8815;"),w.longleftarrow=l(T,"\\longleftarrow ","&#8592;"),w.longrightarrow=l(T,"\\longrightarrow ","&#8594;"),w.Longleftarrow=l(T,"\\Longleftarrow ","&#8656;"),w.Longrightarrow=l(T,"\\Longrightarrow ","&#8658;"),w.longleftrightarrow=l(T,"\\longleftrightarrow ","&#8596;"),w.updownarrow=l(T,"\\updownarrow ","&#8597;"),w.Longleftrightarrow=l(T,"\\Longleftrightarrow ","&#8660;"),w.Updownarrow=l(T,"\\Updownarrow ","&#8661;"),w.mapsto=l(T,"\\mapsto ","&#8614;"),w.nearrow=l(T,"\\nearrow ","&#8599;"),w.hookleftarrow=l(T,"\\hookleftarrow ","&#8617;"),w.hookrightarrow=l(T,"\\hookrightarrow ","&#8618;"),w.searrow=l(T,"\\searrow ","&#8600;"),w.leftharpoonup=l(T,"\\leftharpoonup ","&#8636;"),w.rightharpoonup=l(T,"\\rightharpoonup ","&#8640;"),w.swarrow=l(T,"\\swarrow ","&#8601;"),w.leftharpoondown=l(T,"\\leftharpoondown ","&#8637;"),w.rightharpoondown=l(T,"\\rightharpoondown ","&#8641;"),w.nwarrow=l(T,"\\nwarrow ","&#8598;"),w.ldots=l(T,"\\ldots ","&#8230;"),w.cdots=l(T,"\\cdots ","&#8943;"),w.vdots=l(T,"\\vdots ","&#8942;"),w.ddots=l(T,"\\ddots ","&#8945;"),w.surd=l(T,"\\surd ","&#8730;"),w.triangle=l(T,"\\triangle ","&#9651;"),w.ell=l(T,"\\ell ","&#8467;"),w.top=l(T,"\\top ","&#8868;"),w.flat=l(T,"\\flat ","&#9837;"),w.natural=l(T,"\\natural ","&#9838;"),w.sharp=l(T,"\\sharp ","&#9839;"),w.wp=l(T,"\\wp ","&#8472;"),w.bot=l(T,"\\bot ","&#8869;"),w.clubsuit=l(T,"\\clubsuit ","&#9827;"),w.diamondsuit=l(T,"\\diamondsuit ","&#9826;"),w.heartsuit=l(T,"\\heartsuit ","&#9825;"),w.spadesuit=l(T,"\\spadesuit ","&#9824;"),w.parallelogram=l(T,"\\parallelogram ","&#9649;"),w.square=l(T,"\\square ","&#11036;"),w.oint=l(T,"\\oint ","&#8750;"),w.bigcap=l(T,"\\bigcap ","&#8745;"),w.bigcup=l(T,"\\bigcup ","&#8746;"),w.bigsqcup=l(T,"\\bigsqcup ","&#8852;"),w.bigvee=l(T,"\\bigvee ","&#8744;"),w.bigwedge=l(T,"\\bigwedge ","&#8743;"),w.bigodot=l(T,"\\bigodot ","&#8857;"),w.bigotimes=l(T,"\\bigotimes ","&#8855;"),w.bigoplus=l(T,"\\bigoplus ","&#8853;"),w.biguplus=l(T,"\\biguplus ","&#8846;"),w.lfloor=l(T,"\\lfloor ","&#8970;"),w.rfloor=l(T,"\\rfloor ","&#8971;"),w.lceil=l(T,"\\lceil ","&#8968;"),w.rceil=l(T,"\\rceil ","&#8969;"),w.opencurlybrace=w.lbrace=l(T,"\\lbrace ","{"),w.closecurlybrace=w.rbrace=l(T,"\\rbrace ","}"),w.lbrack=l(T,"["),w.rbrack=l(T,"]"),w.slash=l(T,"/"),w.vert=l(T,"|"),w.perp=w.perpendicular=l(T,"\\perp ","&perp;"),w.nabla=w.del=l(T,"\\nabla ","&nabla;"),w.hbar=l(T,"\\hbar ","&#8463;"),w.AA=w.Angstrom=w.angstrom=l(T,"\\text\\AA ","&#8491;"),w.ring=w.circ=w.circle=l(T,"\\circ ","&#8728;"),w.bull=w.bullet=l(T,"\\bullet ","&bull;"),w.setminus=w.smallsetminus=l(T,"\\setminus ","&#8726;"),w.not=w["¬"]=w.neg=l(T,"\\neg ","&not;"),w["…"]=w.dots=w.ellip=w.hellip=w.ellipsis=w.hellipsis=l(T,"\\dots ","&hellip;"),w.converges=w.darr=w.dnarr=w.dnarrow=w.downarrow=l(T,"\\downarrow ","&darr;"),w.dArr=w.dnArr=w.dnArrow=w.Downarrow=l(T,"\\Downarrow ","&dArr;"),w.diverges=w.uarr=w.uparrow=l(T,"\\uparrow ","&uarr;"),w.uArr=w.Uparrow=l(T,"\\Uparrow ","&uArr;"),w.to=l(U,"\\to ","&rarr;"),w.rarr=w.rightarrow=l(T,"\\rightarrow ","&rarr;"),w.implies=l(U,"\\Rightarrow ","&rArr;"),w.rArr=w.Rightarrow=l(T,"\\Rightarrow ","&rArr;"),w.gets=l(U,"\\gets ","&larr;"),w.larr=w.leftarrow=l(T,"\\leftarrow ","&larr;"),w.impliedby=l(U,"\\Leftarrow ","&lArr;"),w.lArr=w.Leftarrow=l(T,"\\Leftarrow ","&lArr;"),w.harr=w.lrarr=w.leftrightarrow=l(T,"\\leftrightarrow ","&harr;"),w.iff=l(U,"\\Leftrightarrow ","&hArr;"),w.hArr=w.lrArr=w.Leftrightarrow=l(T,"\\Leftrightarrow ","&hArr;"),w.Re=w.Real=w.real=l(T,"\\Re ","&real;"),w.Im=w.imag=w.image=w.imagin=w.imaginary=w.Imaginary=l(T,"\\Im ","&image;"),w.part=w.partial=l(T,"\\partial ","&part;"),w.infty=w.infin=w.infinity=l(T,"\\infty ","&infin;"),w.alef=w.alefsym=w.aleph=w.alephsym=l(T,"\\aleph ","&alefsym;"),w.xist=w.xists=w.exist=w.exists=l(T,"\\exists ","&exist;"),w.nexists=w.nexist=l(T,"\\nexists ","&#8708;"),w.and=w.land=w.wedge=l(T,"\\wedge ","&and;"),w.or=w.lor=w.vee=l(T,"\\vee ","&or;"),w.o=w.O=w.empty=w.emptyset=w.oslash=w.Oslash=w.nothing=w.varnothing=l(U,"\\varnothing ","&empty;"),w.cup=w.union=l(U,"\\cup ","&cup;"),w.cap=w.intersect=w.intersection=l(U,"\\cap ","&cap;"),w.deg=w.degree=l(T,"\\degree ","&deg;"),w.ang=w.angle=l(T,"\\angle ","&ang;"),w.measuredangle=l(T,"\\measuredangle ","&#8737;");var Fa=n(T,function(a,b){a.createLeftOf=function(a){a.options.autoSubscriptNumerals&&a.parent!==a.parent.parent.sub&&(a[o]instanceof Ga&&a[o].isItalic!==!1||a[o]instanceof la&&a[o][o]instanceof Ga&&a[o][o].isItalic!==!1)?(w._().createLeftOf(a),b.createLeftOf.call(this,a),a.insRightOf(a.parent.parent)):b.createLeftOf.call(this,a)}}),Ga=n(S,function(a,b){a.init=function(a,c){b.init.call(this,a,"<var>"+(c||a)+"</var>")},a.text=function(){var a=this.ctrlSeq;return this.isPartOfOperator?"\\"==a[0]?a=a.slice(1,a.length):" "==a[a.length-1]&&(a=a.slice(0,-1)):(!this[o]||this[o]instanceof Ga||this[o]instanceof U||"\\ "===this[o].ctrlSeq||(a="*"+a),!this[p]||this[p]instanceof U||this[p]instanceof la||(a+="*")),a}});C.p.autoCommands={_maxLength:0},D.autoCommands=function(a){if(!/^[a-z]+(?: [a-z]+)*$/i.test(a))throw'"'+a+'" not a space-delimited list of only letters';for(var b=a.split(" "),c={},d=0,e=0;e<b.length;e+=1){var g=b[e];if(g.length<2)throw'autocommand "'+g+'" not minimum length of 2';if(w[g]===La)throw'"'+g+'" is a built-in operator name';c[g]=1,d=f(d,g.length)}return c._maxLength=d,c};var Ha=n(Ga,function(a,b){function c(a){return!a||a instanceof U||a instanceof na}a.init=function(a){return b.init.call(this,this.letter=a)},a.createLeftOf=function(a){b.createLeftOf.apply(this,arguments);var c=a.options.autoCommands,d=c._maxLength;if(d>0){for(var e="",f=this,g=0;f instanceof Ha&&f.ctrlSeq===f.letter&&g<d;)e=f.letter+e,f=f[o],g+=1;for(;e.length;){if(c.hasOwnProperty(e)){for(var g=1,f=this;g<e.length;g+=1,f=f[o]);return v(f,this).remove(),a[o]=f[o],w[e](e).createLeftOf(a)}e=e.slice(1)}}},a.italicize=function(a){return this.isItalic=a,this.isPartOfOperator=!a,this.jQ.toggleClass("mq-operator-name",!a),this},a.finalizeTree=a.siblingDeleted=a.siblingCreated=function(a,b){b!==o&&this[p]instanceof Ha||this.autoUnItalicize(a)},a.autoUnItalicize=function(a){var b=a.autoOperatorNames;if(0!==b._maxLength){for(var d=this.letter,f=this[o];f instanceof Ha;f=f[o])d=f.letter+d;for(var g=this[p];g instanceof Ha;g=g[p])d+=g.letter;v(f[p]||this.parent.ends[o],g[o]||this.parent.ends[p]).each(function(a){a.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),a.ctrlSeq=a.letter});a:for(var h=0,i=f[p]||this.parent.ends[o];h<d.length;h+=1,i=i[p])for(var j=e(b._maxLength,d.length-h);j>0;j-=1){var k=d.slice(h,h+j);if(b.hasOwnProperty(k)){for(var l=0,m=i;l<j;l+=1,m=m[p]){m.italicize(!1);var n=m}var q=Ia.hasOwnProperty(k);if(i.ctrlSeq=(q?"\\":"\\operatorname{")+i.ctrlSeq,n.ctrlSeq+=q?" ":"}",Ka.hasOwnProperty(k)&&n[o][o][o].jQ.addClass("mq-last"),c(i[o])||i.jQ.addClass("mq-first"),!c(n[p]))if(n[p]instanceof la){var r=n[p],s=r.siblingCreated=r.siblingDeleted=function(){r.jQ.toggleClass("mq-after-operator-name",!(r[p]instanceof va))};s()}else n.jQ.toggleClass("mq-last",!(n[p]instanceof va));h+=j-1,i=n;continue a}}}}}),Ia={},Ja=C.p.autoOperatorNames={_maxLength:9},Ka={limsup:1,liminf:1,projlim:1,injlim:1};!function(){for(var a="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" "),b=0;b<a.length;b+=1)Ia[a[b]]=Ja[a[b]]=1;for(var c="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),b=0;b<c.length;b+=1)Ia[c[b]]=1;for(var d="sin cos tan sec cosec csc cotan cot ctg".split(" "),b=0;b<d.length;b+=1)Ja[d[b]]=Ja["arc"+d[b]]=Ja[d[b]+"h"]=Ja["ar"+d[b]+"h"]=Ja["arc"+d[b]+"h"]=1;for(var e="gcf hcf lcm proj span".split(" "),b=0;b<e.length;b+=1)Ja[e[b]]=1}(),D.autoOperatorNames=function(a){if(!/^[a-z]+(?: [a-z]+)*$/i.test(a))throw'"'+a+'" not a space-delimited list of only letters';for(var b=a.split(" "),c={},d=0,e=0;e<b.length;e+=1){var g=b[e];if(g.length<2)throw'"'+g+'" not minimum length of 2';c[g]=1,d=f(d,g.length)}return c._maxLength=d,c};var La=n(S,function(a,b){a.init=function(a){this.ctrlSeq=a},a.createLeftOf=function(a){for(var b=this.ctrlSeq,c=0;c<b.length;c+=1)Ha(b.charAt(c)).createLeftOf(a)},a.parser=function(){for(var a=this.ctrlSeq,b=V(),c=0;c<a.length;c+=1)Ha(a.charAt(c)).adopt(b,b.ends[p],0);return O.succeed(b.children())}});for(var Ma in Ja)Ja.hasOwnProperty(Ma)&&(w[Ma]=La);w.operatorname=n(R,function(a){a.createLeftOf=g,a.numBlocks=function(){return 1},a.parser=function(){return P.block.map(function(a){return a.children()})}}),w.f=n(Ha,function(a,b){a.init=function(){S.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},a.italicize=function(a){return this.jQ.html("f").toggleClass("mq-f",a),b.italicize.apply(this,arguments)}}),w[" "]=w.space=l(T,"\\ ","&nbsp;"),w["'"]=w.prime=l(T,"'","&prime;"),w["″"]=w.dprime=l(T,"″","&Prime;"),w.backslash=l(T,"\\backslash ","\\"),x["\\"]||(x["\\"]=w.backslash),w.$=l(T,"\\$","$");var Na=n(S,function(a,b){a.init=function(a,c){b.init.call(this,a,'<span class="mq-nonSymbola">'+(c||a)+"</span>")}});w["@"]=Na,w["&"]=l(Na,"\\&","&amp;"),w["%"]=l(Na,"\\%","%"),w.alpha=w.beta=w.gamma=w.delta=w.zeta=w.eta=w.theta=w.iota=w.kappa=w.mu=w.nu=w.xi=w.rho=w.sigma=w.tau=w.chi=w.psi=w.omega=n(Ga,function(a,b){a.init=function(a){b.init.call(this,"\\"+a+" ","&"+a+";")}}),w.phi=l(Ga,"\\phi ","&#981;"),w.phiv=w.varphi=l(Ga,"\\varphi ","&phi;"),w.epsilon=l(Ga,"\\epsilon ","&#1013;"),w.epsiv=w.varepsilon=l(Ga,"\\varepsilon ","&epsilon;"),w.piv=w.varpi=l(Ga,"\\varpi ","&piv;"),w.sigmaf=w.sigmav=w.varsigma=l(Ga,"\\varsigma ","&sigmaf;"),w.thetav=w.vartheta=w.thetasym=l(Ga,"\\vartheta ","&thetasym;"),w.upsilon=w.upsi=l(Ga,"\\upsilon ","&upsilon;"),w.gammad=w.Gammad=w.digamma=l(Ga,"\\digamma ","&#989;"),w.kappav=w.varkappa=l(Ga,"\\varkappa ","&#1008;"),w.rhov=w.varrho=l(Ga,"\\varrho ","&#1009;"),w.pi=w["π"]=l(Na,"\\pi ","&pi;"),w.lambda=l(Na,"\\lambda ","&lambda;"),w.Upsilon=w.Upsi=w.upsih=w.Upsih=l(S,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),w.Gamma=w.Delta=w.Theta=w.Lambda=w.Xi=w.Pi=w.Sigma=w.Phi=w.Psi=w.Omega=w.forall=n(T,function(a,b){a.init=function(a){b.init.call(this,"\\"+a+" ","&"+a+";")}});var Oa=n(R,function(a){a.init=function(a){this.latex=a},a.createLeftOf=function(a){var b=P.parse(this.latex);b.children().adopt(a.parent,a[o],a[p]),a[o]=b.ends[p],b.jQize().insertBefore(a.jQ),b.finalizeInsert(a.options,a),b.ends[p][p].siblingCreated&&b.ends[p][p].siblingCreated(a.options,o),b.ends[o][o].siblingCreated&&b.ends[o][o].siblingCreated(a.options,p),a.parent.bubble("reflow")},a.parser=function(){var a=P.parse(this.latex).children();return O.succeed(a)}});w["¹"]=l(Oa,"^1"),w["²"]=l(Oa,"^2"),w["³"]=l(Oa,"^3"),w["¼"]=l(Oa,"\\frac14"),w["½"]=l(Oa,"\\frac12"),w["¾"]=l(Oa,"\\frac34");var Pa=n(U,function(a){a.init=T.prototype.init,a.contactWeld=a.siblingCreated=a.siblingDeleted=function(a,b){function c(a){return a[o]?a[o]instanceof U||/^[,;:\(\[]$/.test(a[o].ctrlSeq)?"":"mq-binary-operator":a.parent&&a.parent.parent&&a.parent.parent.isStyleBlock()?c(a.parent.parent):""}if(b!==p)return this.jQ[0].className=c(this),this}});w["+"]=l(Pa,"+","+"),w["–"]=w["-"]=l(Pa,"-","&minus;"),w["±"]=w.pm=w.plusmn=w.plusminus=l(Pa,"\\pm ","&plusmn;"),w.mp=w.mnplus=w.minusplus=l(Pa,"\\mp ","&#8723;"),x["*"]=w.sdot=w.cdot=l(U,"\\cdot ","&middot;","*");var Qa=n(U,function(a,b){a.init=function(a,c){this.data=a,this.strict=c;var d=c?"Strict":"";b.init.call(this,a["ctrlSeq"+d],a["html"+d],a["text"+d])},a.swap=function(a){this.strict=a;var b=a?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+b],this.jQ.html(this.data["html"+b]),this.textTemplate=[this.data["text"+b]]},a.deleteTowards=function(a,c){return a!==o||this.strict?void b.deleteTowards.apply(this,arguments):(this.swap(!0),void this.bubble("reflow"))}}),Ra={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},Sa={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};w["<"]=w.lt=l(Qa,Ra,!0),w[">"]=w.gt=l(Qa,Sa,!0),w["≤"]=w.le=w.leq=l(Qa,Ra,!1),w["≥"]=w.ge=w.geq=l(Qa,Sa,!1);var Ta=n(U,function(a,b){a.init=function(){b.init.call(this,"=","=")},a.createLeftOf=function(a){return a[o]instanceof Qa&&a[o].strict?(a[o].swap(!1),void a[o].bubble("reflow")):void b.createLeftOf.apply(this,arguments)}});w["="]=Ta,w["×"]=w.times=l(U,"\\times ","&times;","[x]"),w["÷"]=w.div=w.divide=w.divides=l(U,"\\div ","&divide;","[/]"),x["~"]=w.sim=l(U,"\\sim ","~","~");var Ua=K(1);for(var Va in Ua)(function(a,b){"function"==typeof b?(H[a]=function(){return G(),b.apply(this,arguments)},H[a].prototype=b.prototype):H[a]=b})(Va,Ua[Va])}();