<html>
<head><title>Root Systems </title>
</head>
<body>


<SCRIPT TYPE="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.4/dojo/dojo.xd.js" djConfig = "parseOnLoad: true"></SCRIPT>
<div style="width:400;height:400;border:solid 1px" id="canvasMain" onmouseup="//clickCanvasMain(event.clientX, event.clientY);" onmousedown="generateRootSystemFromWeylLetterAndDim('G',2);"></div>

<div id="outputField">
</div>
<script type="text/javascript">
/*	var oldDimension=-1;
	var oldNumVectors=-1;
	var NumElements=0;
	var node;
	var surface;
	var MaxNumCoords=5;
	var Basis= new Array(MaxNumCoords);
	var Xshift=150;
	var Yshift=250;
	var selectedBasisIndex=-1;//-2 = center of coord system is selected
	var GraphicsUnit=100;
	var clickTolerance=0.1;
	var RootsArray;
	function ptsWithinClickTolerance(x1, y1, x2, y2)
	{ if (x1-x2>clickTolerance || x2-x1>clickTolerance || y1-y2>clickTolerance || y2-y1>clickTolerance )
		{ return false;
		}
		return true;
	}
	function clickCanvasMain(cx,cy)
	{ divPosX=0;
		divPosY=0;
		thePointer= canvasMain;
		while(thePointer)
		{ divPosX += thePointer.offsetLeft;
    	divPosY += thePointer.offsetTop;
    	thePointer = thePointer.offsetParent;
		}
//		alert(cy-divPosY+document.body.scrollTop);
		posx=(cx-divPosX+document.body.scrollLeft-Xshift)/GraphicsUnit;
		posy=(cy-divPosY+document.body.scrollTop-Yshift)/GraphicsUnit;
		if (!(selectedBasisIndex==-1))
		{ if (selectedBasisIndex==-2)
			{ Xshift=(cx-divPosX+document.body.scrollLeft);
				Yshift=(cy-divPosY+document.body.scrollTop);
			}
			else
			{	Basis[selectedBasisIndex][0]=posx;
				Basis[selectedBasisIndex][1]=posy;
			}
			surface.clear();
			selectedBasisIndex=-1;
			drawOnCanvasMain();
			//nothing after this procedure gets executed (dunno why, wtf)
		} else
		{ if (ptsWithinClickTolerance(posx,posy,0,0))
			{ selectedBasisIndex=-2;
			}
			for (i=0;i<MaxNumCoords;i++)
			{ if (ptsWithinClickTolerance(posx,posy,Basis[i][0],Basis[i][1]))
				{ selectedBasisIndex=i;
				}
			}
			//alert("selected index"+selectedBasisIndex);
		}
	}
	for (i=0; i<5; i++)
	{ Basis[i]= new Array(2);
	}
	Basis[0][0]=1.7;  Basis[0][1]=0.8;
	Basis[1][0]=0;    Basis[1][1]=-2;
	Basis[2][0]=1.5;  Basis[2][1]=-1.8;
	Basis[3][0]=-0.8; Basis[3][1]=1.4;
	Basis[4][0]=1.6;  Basis[4][1]=0.9;
	function getCoord(thePoint,Coord)
	{ result=Number(0);
		for (counterI=0;counterI<oldDimension;counterI++)
		{ result= result+ thePoint[counterI]*Basis[counterI][Coord];
		}
		result=Math.floor(result);
		return result;
	}
	function drawOnCanvasMain()
	{//	alert("paint");
		for (CounterK=0; CounterK<numdaLines; CounterK++)
		{ xCoord1=getCoord(da1[CounterK],0)+Xshift;
			yCoord1=getCoord(da1[CounterK],1)+Yshift;
			xCoord2=getCoord(da2[CounterK],0)+Xshift;
			yCoord2=getCoord(da2[CounterK],1)+Yshift;
			surface.createLine({ x1 : xCoord1, y1 : yCoord1, x2 : xCoord2, y2 : yCoord2 }).setStroke(clrda[CounterK]);
		}
		for (CounterK=0; CounterK<numlLines; CounterK++)
		{ xCoord1=getCoord(l1[CounterK],0)+Xshift;
			yCoord1=getCoord(l1[CounterK],1)+Yshift;
			xCoord2=getCoord(l2[CounterK],0)+Xshift;
			yCoord2=getCoord(l2[CounterK],1)+Yshift;
			surface.createLine({ x1 : xCoord1, y1 : yCoord1, x2 : xCoord2, y2 : yCoord2 }).setStroke(clrl[CounterK]);
		}
	}
	function drawOnCanvasMainPlusInit()
	{ node = dojo.byId(canvasMain);
		surface = dojox.gfx.createSurface(node, 400, 400);
		drawOnCanvasMain();
	}
	dojo.require("dojox.gfx");
	dojo.addOnLoad(drawOnCanvasMainPlusInit);
//generatePageFromDimAndNum(3,9,-1,-1);*/
</script>
<script type="text/javascript">
var CartanSymmetric;
var theRootSystem;
var theRootSystemSize;
var theRootSystemHashes;
var theRootSystemHashesSizes;
var HashSize=1000;
var theWeylLetter;
var theWeylDim;

function generateRootSystemFromWeylLetterAndDim(WeylLetter, WeylDim)
{ if (WeylLetter!='A' && WeylLetter!='B' && WeylLetter!='C' && WeylLetter!='D' && WeylLetter!='E' && WeylLetter!='F' && WeylLetter!='G' )
    return;
  if (WeylDim>9 || WeylDim<1)
    return;
  makeCartanArbitrary(WeylLetter, WeylDim);
  GenerateRootSystem();
}

function makeCartanArbitrary(WeylLetter, WeylDim)
{ theWeylLetter=WeylLetter;
  theWeylDim= WeylDim;
  if (theWeylLetter=='E')
  { if (theWeylDim<6)
      theWeylDim=6;
    if (theWeylDim>8)
      theWeylDim=8;
  }
  if (theWeylLetter=='G')
    theWeylDim=2;
  makeCartanAn(theWeylDim);
  if (theWeylLetter=='E')
  { CartanSymmetric[0][1]=0; CartanSymmetric[1][0]=0;
    CartanSymmetric[1][2]=0; CartanSymmetric[2][1]=0;
    CartanSymmetric[0][2]=-1; CartanSymmetric[2][0]=-1;
    CartanSymmetric[1][3]=-1; CartanSymmetric[3][1]=-1;
  }  
  if (theWeylLetter=='G')
  { CartanSymmetric[0][0]=6; CartanSymmetric[0][1]=-3;
    CartanSymmetric[1][0]=-3; CartanSymmetric[1][1]=2;
  }
}

function makeCartanAn(WeylDim)
{ CartanSymmetric= new Array(WeylDim);
  for (var i=0; i<WeylDim; i++)
  { CartanSymmetric[i]= new Array(WeylDim);
    for (var j=0; j<WeylDim; j++)
      CartanSymmetric[i][j]=0;
    CartanSymmetric[i][i]=2;
    if (i<WeylDim-1)
      CartanSymmetric[i][i+1]=-1;
    if (i>0)
      CartanSymmetric[i][i-1]=-1;
  }
}

function ClearRootSystem()
{ theRootSystemHashes= new Array(HashSize);
  theRootSystemHashesSizes= new Array(HashSize);
  theRootSystem= new Object(Array(HashSize));
  for (var i=0; i<HashSize; i++)
  { theRootSystemHashesSizes[i]=0;
    theRootSystemHashes[i]= new Array();
  }
  theRootSystemSize=0;
}

function HashFunctionRoot(theRoot, theWeylDim)
{ var result=0;
  for (var i=0; i<theWeylDim; i++)
    result+=(i+6)*(6+1)*theRoot[i];
  result= result % HashSize;
  if (result<0)
    result+=HashSize;
  return result;
}

function getRootIndex(theRoot, theWeylDim)
{ var theHash = HashFunctionRoot(theRoot, theWeylDim);
  var hashArraySize=theRootSystemHashesSizes[theHash];
  for (var i=0; i<hashArraySize; i++)
  { theIndex=theRootSystemHashes[theHash][i];
    if (AreEqualRoots(theRootSystem[theIndex], theRoot, theWeylDim))
      return theIndex;
  }
  return -1;
}

function AreEqualRoots(root1, root2, theDim)
{ for (var i=0; i<theDim; i++)
    if (root1[i]!=root2[i])
      return false;
  return true;
}

function addToRootSystemNoRepetition(theRoot)
{ var theIndex=getRootIndex(theRoot, theWeylDim);
  if (theIndex==-1)
  { theRootSystem[theRootSystemSize]=new Array(theWeylDim);
    for (var i=0; i<theWeylDim; i++)
      theRootSystem[theRootSystemSize][i]=theRoot[i];
    var theHashIndex=HashFunctionRoot(theRoot, theWeylDim);
    var theHashSize=theRootSystemHashesSizes[theHashIndex];
    theRootSystemHashes[theHashIndex][theHashSize]=theRootSystemSize;
    theRootSystemHashesSizes[theHashIndex]++;
    theRootSystemSize++;
  }
  return false;
}

function getScalarProduct(root1, root2)
{ var result=0; 
  for (var i=0; i<theWeylDim; i++)
    for (var j=0; j<theWeylDim; j++)
      result+= root1[i]*root2[j]*CartanSymmetric[i][j];
  
  return result;
}

function ActOnARootGenIndex(theIndex, input, output)
{ for (i=0; i<theWeylDim; i++)
    output[i]= input[i];
  theScalarProduct=getScalarProduct(theRootSystem[theIndex], input);
  output[theIndex]-= theScalarProduct*2/getScalarProduct(theRootSystem[theIndex],theRootSystem[theIndex]);
  return output;
}

function GenerateRootSystem()
{ var theOutputRoot= new Object(Array(theWeylDim));
  ClearRootSystem();
  for (var j=0; j<theWeylDim; j++)
  { for (var i=0; i<theWeylDim; i++)
      theOutputRoot[i]=0;
    theOutputRoot[j]=1;
    addToRootSystemNoRepetition(theOutputRoot);
  }
  for (var l=0 ;l<theRootSystemSize; l++)
  { for (var j=0; j<theWeylDim; j++)
    { theOutputRoot=ActOnARootGenIndex(j, theRootSystem[l], theOutputRoot);
      addToRootSystemNoRepetition(theOutputRoot);
    }
  }
  WriteRootSystem();
}

function WriteRootSystem()
{ var output = document.getElementById("outputField");
  var tempS;
  for (var i=0; i<theRootSystemSize; i++)
  { tempS="(";
    for (var j=0; j<theWeylDim; j++)
    { tempS=tempS+theRootSystem[i][j];
      if (j!=theWeylDim-1)
        tempS=tempS+",";
    }
    tempS=tempS+")";
    output.appendChild(document.createTextNode(tempS));
    if (i!=theRootSystemSize-1)
      output.appendChild(document.createElement("br"));
  }  
}
</script>
</body>
</html>


